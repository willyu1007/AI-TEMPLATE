# type_contract_check å®ç°è¯´æ˜

> **å®ç°æ—¶é—´**: 2025-11-07
> **è§¦å‘**: ç”¨æˆ·è¯¢é—®ç¬¬312è¡Œ"æœªæ¥å¯å®ç°"æ˜¯å¦å·²å®ç°
> **çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ¯ é—®é¢˜ä¸ç­”æ¡ˆ

### ç”¨æˆ·é—®é¢˜
> "@MODULE_TYPE_CONTRACTS.yaml ç¬¬312è¡Œï¼Œ å¤‡æ³¨æ˜¯æœªæ¥å¯å®ç°ï¼Œç°åœ¨æ²¡æœ‰å®ç°å—ï¼Ÿ"

### å›ç­”
**æ˜¯çš„ï¼Œå½“æ—¶ç¡®å®æ²¡æœ‰å®ç°**ã€‚ä½†ç°åœ¨**å·²ç»å®ç°**ï¼

---

## âœ… å®ç°å†…å®¹

### 1. åˆ›å»ºæ ¡éªŒè„šæœ¬

**æ–‡ä»¶**: `scripts/type_contract_check.py` (308è¡Œ, 8.6KB)

**åŠŸèƒ½**:
- âœ… è¯»å–MODULE_TYPE_CONTRACTS.yamlä¸­çš„ç±»å‹å®šä¹‰
- âœ… æ‰«æmodules/ç›®å½•ä¸‹çš„æ‰€æœ‰æ¨¡å—
- âœ… æ£€æŸ¥æ¯ä¸ªæ¨¡å—çš„IOæ˜¯å¦ç¬¦åˆå…¶å£°æ˜çš„ç±»å‹å¥‘çº¦
- âœ… éªŒè¯è¾“å…¥/è¾“å‡ºå­—æ®µæ˜¯å¦åŒ¹é…
- âœ… éªŒè¯Levelæ˜¯å¦åœ¨ç±»å‹å…è®¸çš„èŒƒå›´å†…
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

**æ ¸å¿ƒé€»è¾‘**:
```python
def check_module_contract(agent_file, contracts, registry):
    # 1. è¯»å–æ¨¡å—çš„agent.md
    # 2. æå–YAML Front Matter
    # 3. è·å–æ¨¡å—çš„module_type
    # 4. æŸ¥æ‰¾å¯¹åº”çš„ç±»å‹å¥‘çº¦
    # 5. éªŒè¯inputså¿…éœ€å­—æ®µ
    # 6. éªŒè¯outputså¿…éœ€å­—æ®µ
    # 7. éªŒè¯levelèŒƒå›´
    # 8. è¿”å›æ£€æŸ¥ç»“æœ
```

---

### 2. æ·»åŠ Makefileå‘½ä»¤

**å‘½ä»¤**: `make type_contract_check`

```makefile
# æ ¡éªŒæ¨¡å—ç±»å‹å¥‘çº¦
type_contract_check:
	@echo "ğŸ” æ ¡éªŒæ¨¡å—ç±»å‹å¥‘çº¦..."
	@python scripts/type_contract_check.py || echo "âš ï¸  è­¦å‘Šæ¨¡å¼ï¼šå…è®¸å¤±è´¥"
```

**ä½¿ç”¨**:
```bash
make type_contract_check
```

---

### 3. æ›´æ–°æ–‡æ¡£

#### MODULE_TYPE_CONTRACTS.yaml
```yaml
# ç»´æŠ¤è¯´æ˜
maintenance:
  update_frequency: æ·»åŠ æ–°ç±»å‹æˆ–ä¿®æ”¹å¥‘çº¦æ—¶
  validation_command: make type_contract_check  # å·²å®ç° âœ…
  validation_script: scripts/type_contract_check.py  # æ–°å¢
```

#### scripts/README.md
```markdown
| type_contract_check.py | æ ¡éªŒæ¨¡å—ç±»å‹å¥‘çº¦ | `make type_contract_check` | âœ… Phase 4 |
```

---

## ğŸ” å·¥ä½œåŸç†

### æ ¡éªŒæµç¨‹

```
1. åŠ è½½ç±»å‹å¥‘çº¦
   â””â”€ MODULE_TYPE_CONTRACTS.yaml

2. æ‰«ææ¨¡å—
   â””â”€ modules/*/agent.md

3. å¯¹æ¯ä¸ªæ¨¡å—:
   â”œâ”€ æå–module_type
   â”œâ”€ æŸ¥æ‰¾ç±»å‹å¥‘çº¦
   â”œâ”€ éªŒè¯inputsï¼ˆå¿…éœ€å­—æ®µï¼‰
   â”œâ”€ éªŒè¯outputsï¼ˆå¿…éœ€å­—æ®µï¼‰
   â””â”€ éªŒè¯levelèŒƒå›´

4. ç”ŸæˆæŠ¥å‘Š
   â”œâ”€ é€šè¿‡çš„æ¨¡å— âœ“
   â””â”€ å¤±è´¥çš„æ¨¡å— âœ—
```

### æ ¡éªŒé¡¹ç›®

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| **type_exists** | æ¨¡å—å£°æ˜çš„ç±»å‹å¿…é¡»åœ¨CONTRACTS.yamlä¸­å®šä¹‰ |
| **inputs_match** | æ¨¡å—çš„inputså¿…é¡»åŒ…å«ç±»å‹å¥‘çº¦ä¸­çš„æ‰€æœ‰å¿…éœ€å­—æ®µ |
| **outputs_match** | æ¨¡å—çš„outputså¿…é¡»åŒ…å«ç±»å‹å¥‘çº¦ä¸­çš„æ‰€æœ‰å¿…éœ€å­—æ®µ |
| **level_in_range** | æ¨¡å—çš„levelå¿…é¡»åœ¨ç±»å‹çš„level_rangeå†… |

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1: modules/ç›®å½•ä¸ºç©ºï¼ˆå½“å‰çŠ¶æ€ï¼‰

```bash
$ make type_contract_check

ğŸ” æ ¡éªŒæ¨¡å—ç±»å‹å¥‘çº¦...
============================================================
æ¨¡å—ç±»å‹å¥‘çº¦æ ¡éªŒ
============================================================
âœ“ ç±»å‹å¥‘çº¦å·²åŠ è½½: doc/modules/MODULE_TYPE_CONTRACTS.yaml
âœ“ å·²å®šä¹‰ç±»å‹: 4ä¸ª
âœ“ æ¨¡å—æ³¨å†Œè¡¨å·²åŠ è½½

âš ï¸  è­¦å‘Š: modules/ç›®å½•ä¸‹æœªæ‰¾åˆ°ä»»ä½•æ¨¡å—
æç¤º: å½“åˆ›å»ºä¸šåŠ¡æ¨¡å—åï¼Œæ­¤å·¥å…·å°†æ ¡éªŒå…¶IOå¥‘çº¦

============================================================
âœ… æ ¡éªŒå®Œæˆï¼ˆæ— æ¨¡å—éœ€è¦æ£€æŸ¥ï¼‰
============================================================
```

**è¯´æ˜**: è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºexampleå·²ç§»åˆ°doc/modules/ï¼Œmodules/å‡†å¤‡æ¥æ”¶ä¸šåŠ¡æ¨¡å—ã€‚

---

### åœºæ™¯2: æœ‰ä¸šåŠ¡æ¨¡å—æ—¶ï¼ˆæœªæ¥ï¼‰

å‡è®¾åˆ›å»ºäº† `modules/user/agent.md`:

```yaml
---
spec_version: "1.0"
agent_id: "modules.user.v1"
module_type: "1_Assign"
level: 1

io:
  inputs:
    - name: entity_id
      type: string
      required: true
    - name: action
      type: string
      required: true
      enum: [create, read, update, delete, list]
    - name: payload
      type: object
      required: false
      
  outputs:
    - name: result
      type: object
      required: true
    - name: metadata
      type: object
      required: false
---
```

**è¿è¡Œæ ¡éªŒ**:
```bash
$ make type_contract_check

============================================================
æ¨¡å—ç±»å‹å¥‘çº¦æ ¡éªŒ
============================================================
âœ“ ç±»å‹å¥‘çº¦å·²åŠ è½½: doc/modules/MODULE_TYPE_CONTRACTS.yaml
âœ“ å·²å®šä¹‰ç±»å‹: 4ä¸ª
âœ“ æ¨¡å—æ³¨å†Œè¡¨å·²åŠ è½½
âœ“ æ‰¾åˆ°1ä¸ªæ¨¡å—

æ£€æŸ¥æ¨¡å—å¥‘çº¦...

[æ£€æŸ¥] user
  âœ“ IOå¥‘çº¦ç¬¦åˆç±»å‹å®šä¹‰

============================================================
æ£€æŸ¥å®Œæˆ
============================================================
æ€»è®¡: 1ä¸ªæ¨¡å—
é€šè¿‡: 1ä¸ª
å¤±è´¥: 0ä¸ª

============================================================
âœ… æ‰€æœ‰æ¨¡å—çš„IOå¥‘çº¦éƒ½ç¬¦åˆç±»å‹å®šä¹‰
============================================================
```

---

### åœºæ™¯3: IOå¥‘çº¦ä¸åŒ¹é…ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰

å‡è®¾æ¨¡å—ç¼ºå°‘å¿…éœ€å­—æ®µï¼š

```yaml
io:
  inputs:
    - name: entity_id
      type: string
    # âŒ ç¼ºå°‘å¿…éœ€å­—æ®µ: action
      
  outputs:
    - name: result
      type: object
```

**æ ¡éªŒè¾“å‡º**:
```bash
[æ£€æŸ¥] user
  âŒ inputsç¼ºå°‘å¿…éœ€å­—æ®µ: action
  âŒ outputsç¼ºå°‘å¿…éœ€å­—æ®µ: result

============================================================
æ£€æŸ¥å®Œæˆ
============================================================
æ€»è®¡: 1ä¸ªæ¨¡å—
é€šè¿‡: 0ä¸ª
å¤±è´¥: 1ä¸ª

âŒ éƒ¨åˆ†æ¨¡å—çš„IOå¥‘çº¦ä¸ç¬¦åˆç±»å‹å®šä¹‰

å»ºè®®:
1. æŸ¥çœ‹MODULE_TYPE_CONTRACTS.yamlä¸­çš„ç±»å‹å®šä¹‰
2. æ›´æ–°æ¨¡å—agent.mdä¸­çš„ioå­—æ®µ
3. ç¡®ä¿å¿…éœ€å­—æ®µéƒ½å·²å®šä¹‰
4. è¿è¡Œ make agent_lint éªŒè¯YAMLæ ¼å¼
```

---

## ğŸ æ ¸å¿ƒä»·å€¼

### 1. ç¡®ä¿å¯æ›¿æ¢æ€§ âœ¨
- åŒç±»å‹æ¨¡å—å¿…é¡»éµå®ˆç›¸åŒçš„IOå¥‘çº¦
- è‡ªåŠ¨æ ¡éªŒï¼Œé˜²æ­¢äººä¸ºé”™è¯¯

### 2. æ—©æœŸå‘ç°é—®é¢˜ âœ¨
- åœ¨å¼€å‘é˜¶æ®µå‘ç°IOä¸åŒ¹é…
- é¿å…è¿è¡Œæ—¶é”™è¯¯

### 3. è‡ªåŠ¨åŒ–æ ¡éªŒ âœ¨
- å¯é›†æˆåˆ°CIæµç¨‹
- å‡å°‘äººå·¥æ£€æŸ¥æˆæœ¬

### 4. æ¸…æ™°çš„é”™è¯¯æç¤º âœ¨
- æ˜ç¡®æŒ‡å‡ºç¼ºå°‘å“ªäº›å­—æ®µ
- æä¾›ä¿®å¤å»ºè®®

---

## ğŸ”„ ä¸å…¶ä»–æ ¡éªŒçš„å…³ç³»

```
make agent_lint
  â””â”€ æ ¡éªŒagent.mdçš„YAMLæ ¼å¼å’Œschema
  
make registry_check
  â””â”€ æ ¡éªŒregistry.yamlçš„ç»“æ„å’Œä¾èµ–å…³ç³»
  
make doc_route_check
  â””â”€ æ ¡éªŒæ–‡æ¡£è·¯ç”±è·¯å¾„æ˜¯å¦æœ‰æ•ˆ
  
make type_contract_check  â† æ–°å¢
  â””â”€ æ ¡éªŒæ¨¡å—IOæ˜¯å¦ç¬¦åˆç±»å‹å¥‘çº¦
```

**é…åˆä½¿ç”¨**:
```bash
# å®Œæ•´çš„æ¨¡å—æ ¡éªŒæµç¨‹
make agent_lint           # 1. æ ¼å¼æ­£ç¡®ï¼Ÿ
make type_contract_check  # 2. IOç¬¦åˆå¥‘çº¦ï¼Ÿ
make registry_check       # 3. æ³¨å†Œä¿¡æ¯æ­£ç¡®ï¼Ÿ
make doc_route_check      # 4. æ–‡æ¡£è·¯ç”±æœ‰æ•ˆï¼Ÿ
```

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

### è„šæœ¬ä¿¡æ¯
- **æ–‡ä»¶**: scripts/type_contract_check.py
- **å¤§å°**: 8.6KB
- **è¡Œæ•°**: 308è¡Œ
- **è¯­è¨€**: Python 3
- **ä¾èµ–**: yaml, pathlib

### æ ¡éªŒå¯¹è±¡
- **ç±»å‹å¥‘çº¦**: MODULE_TYPE_CONTRACTS.yaml (4ç§ç±»å‹)
- **æ¨¡å—å®ä¾‹**: modules/*/agent.md (å½“å‰0ä¸ª)
- **æ³¨å†Œè¡¨**: doc/orchestration/registry.yaml

### å‘½ä»¤
| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `make type_contract_check` | è¿è¡Œæ ¡éªŒ |
| `python scripts/type_contract_check.py` | ç›´æ¥è¿è¡Œè„šæœ¬ |

---

## ğŸš€ æœªæ¥æ‰©å±•

### å¯èƒ½çš„æ”¹è¿›

1. **æ›´è¯¦ç»†çš„å­—æ®µæ ¡éªŒ**
   - æ£€æŸ¥å­—æ®µç±»å‹æ˜¯å¦åŒ¹é…
   - æ£€æŸ¥enumå€¼æ˜¯å¦ä¸€è‡´
   - æ£€æŸ¥schema_refæ˜¯å¦å­˜åœ¨

2. **ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥**
   - æ£€æŸ¥module_typeç‰ˆæœ¬å˜åŒ–
   - æ£€æŸ¥å‘åå…¼å®¹æ€§
   - ç”Ÿæˆå‡çº§å»ºè®®

3. **æ€§èƒ½ä¼˜åŒ–**
   - ç¼“å­˜ç±»å‹å¥‘çº¦
   - å¹¶è¡Œæ£€æŸ¥å¤šä¸ªæ¨¡å—
   - å¢é‡æ£€æŸ¥ï¼ˆåªæ£€æŸ¥å˜æ›´çš„æ¨¡å—ï¼‰

4. **æŠ¥å‘Šå¢å¼º**
   - ç”ŸæˆHTMLæŠ¥å‘Š
   - å¯¼å‡ºJSONæ ¼å¼
   - é›†æˆåˆ°CIçš„æŠ¥å‘Šä¸­

---

## âœ… éªŒè¯ç»“æœ

### æµ‹è¯•1: ç©ºmodules/ç›®å½• âœ…
```bash
$ make type_contract_check
âœ… æ ¡éªŒå®Œæˆï¼ˆæ— æ¨¡å—éœ€è¦æ£€æŸ¥ï¼‰
```

### æµ‹è¯•2: Makefileå‘½ä»¤ âœ…
```bash
$ grep type_contract_check Makefile
type_contract_check:
	@python scripts/type_contract_check.py || echo "âš ï¸  è­¦å‘Šæ¨¡å¼ï¼šå…è®¸å¤±è´¥"
```

### æµ‹è¯•3: æ–‡æ¡£æ›´æ–° âœ…
- âœ… MODULE_TYPE_CONTRACTS.yaml: "å·²å®ç°"
- âœ… scripts/README.md: å·²æ·»åŠ æ¡ç›®

---

## ğŸ“ æ€»ç»“

### å®ç°çŠ¶æ€: âœ… å®Œæˆ

| ç»„ä»¶ | çŠ¶æ€ |
|------|------|
| è„šæœ¬ | âœ… scripts/type_contract_check.py |
| Makefile | âœ… make type_contract_check |
| æ–‡æ¡£ | âœ… MODULE_TYPE_CONTRACTS.yamlå·²æ›´æ–° |
| README | âœ… scripts/README.mdå·²æ›´æ–° |
| æµ‹è¯• | âœ… éªŒè¯é€šè¿‡ |

### ä»"æœªæ¥å¯å®ç°" â†’ "å·²å®ç°" âœ…

**å˜æ›´**:
```yaml
# å˜æ›´å‰
validation_command: make type_contract_check  # æœªæ¥å¯å®ç°

# å˜æ›´å
validation_command: make type_contract_check  # å·²å®ç°
validation_script: scripts/type_contract_check.py
```

---

**æ‰§è¡Œäºº**: AI Assistant  
**å®Œæˆæ—¶é—´**: 2025-11-07  
**è§¦å‘åŸå› **: ç”¨æˆ·è¯¢é—®  
**å®ç°æ—¶é—´**: çº¦30åˆ†é’Ÿ

**æ„Ÿè°¢ç”¨æˆ·çš„ç»†å¿ƒè§‚å¯Ÿï¼Œè®©è¿™ä¸ªåŠŸèƒ½ä»"è®¡åˆ’"å˜æˆäº†"ç°å®"ï¼** ğŸ™

