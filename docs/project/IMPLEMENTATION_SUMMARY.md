# Agent Repo æ”¹è¿›å®æ–½æ‘˜è¦

æ ¹æ® `Agent-Repo-QA-Mapping.md` ä¸­æå‡ºçš„æ”¹è¿›æ–¹æ¡ˆï¼Œå·²å®Œæˆæ‰€æœ‰å®æ–½å·¥ä½œã€‚

## ğŸ“‹ å®æ–½æ¸…å•

### âœ… 1. ç´¢å¼•å“ˆå¸Œä¸ç‰ˆæœ¬ç®¡ç†
- **å‡çº§** `scripts/docgen.py`
  - âœ… å¢åŠ æ–‡æ¡£æ‘˜è¦æå–ï¼ˆé¦– 240 å­—ç¬¦ï¼‰
  - âœ… å¢åŠ å…³é”®è¯æå–ï¼ˆç®€æ˜“ TF ç»Ÿè®¡ï¼‰
  - âœ… å¢åŠ ä¾èµ–å…³ç³»åˆ†æï¼ˆæ–‡ä»¶å¼•ç”¨/å¥‘çº¦å¼•ç”¨ï¼‰
  - âœ… ç”Ÿæˆæ–‡ä»¶å“ˆå¸Œï¼ˆSHA256ï¼‰
  - âœ… ç”Ÿæˆå¿«ç…§å“ˆå¸Œï¼ˆ`snapshot.json`ï¼‰
  - âœ… ç”Ÿæˆ `.aicontext/index.json` å’Œ `.aicontext/snapshot.json`

### âœ… 2. DAG æ ¡éªŒ
- **æ–°å¢** `scripts/dag_check.py`
  - âœ… æ£€æŸ¥é‡å¤èŠ‚ç‚¹
  - âœ… æ£€æŸ¥ç¯è·¯ï¼ˆæ‹“æ‰‘æ’åºï¼‰
  - âœ… æ£€æŸ¥è¾¹å¼•ç”¨æœ‰æ•ˆæ€§
  - âœ… æ£€æŸ¥å¥‘çº¦æ–‡ä»¶å­˜åœ¨
  - âœ… é›†æˆåˆ° `make dag_check`

### âœ… 3. å¥‘çº¦å…¼å®¹æ€§æ£€æŸ¥
- **æ–°å¢** `scripts/contract_compat_check.py`
  - âœ… å¯¹æ¯”åŸºçº¿æ£€æµ‹ç ´åæ€§å˜æ›´
  - âœ… æ£€æŸ¥ç±»å‹å˜æ›´
  - âœ… æ£€æŸ¥æ–°å¢å¿…å¡«å­—æ®µ
  - âœ… æ£€æŸ¥å­—æ®µåˆ é™¤
  - âœ… é›†æˆåˆ° `make contract_compat_check`
- **æ–°å¢** `.contracts_baseline/` ç›®å½•
  - âœ… å­˜å‚¨å¥‘çº¦åŸºçº¿
  - âœ… æä¾› `make update_baselines` æ›´æ–°åŸºçº¿

### âœ… 4. ä¸€è‡´æ€§é—¨ç¦
- **æ–°å¢** `scripts/consistency_check.py`
  - âœ… æ£€æŸ¥å¿«ç…§å“ˆå¸Œä¸€è‡´æ€§
  - âœ… æ£€æŸ¥æ¨¡å—å¿…å¤‡æ–‡æ¡£é½å…¨
  - âœ… æ£€æŸ¥å…³é”®æ–‡ä»¶å­˜åœ¨
  - âœ… é›†æˆåˆ° `make consistency_check`

### âœ… 5. å›æ»šéªŒè¯
- **æ–°å¢** `scripts/rollback_check.sh`
  - âœ… æ£€æŸ¥è¿ç§»è„šæœ¬æˆå¯¹
  - âœ… æ£€æŸ¥ Feature Flag é…ç½®
  - âœ… éªŒè¯å›æ»šç›®æ ‡å¼•ç”¨å­˜åœ¨
  - âœ… é›†æˆåˆ° `make rollback_check PREV_REF=<tag>`

### âœ… 6. è¿è¡Œæ—¶é…ç½®æ ¡éªŒ
- **æ–°å¢** `scripts/runtime_config_check.py`
  - âœ… æ£€æŸ¥é…ç½®æ–‡ä»¶ç»“æ„
  - âœ… æ£€æŸ¥ä¸ schema ä¸€è‡´æ€§
  - âœ… æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒå¿…éœ€å¯†é’¥
  - âœ… æ£€æŸ¥é…ç½®å€¼ç±»å‹
  - âœ… é›†æˆåˆ° `make runtime_config_check`

### âœ… 7. æµ‹è¯•è„šæ‰‹æ¶
- **æ–°å¢** `scripts/test_scaffold.py`
  - âœ… ç”Ÿæˆæµ‹è¯•ç›®å½•ç»“æ„
  - âœ… ç”Ÿæˆ smoke test æ¨¡æ¿
  - âœ… ç”Ÿæˆ pytest fixtures
  - âœ… é›†æˆåˆ° `make ai_begin`

### âœ… 8. è¿ç§»è„šæœ¬ç®¡ç†
- **æ–°å¢** `scripts/migrate_check.py`
  - âœ… æ£€æŸ¥ up/down æˆå¯¹å­˜åœ¨
  - âœ… æ£€æŸ¥ç‰ˆæœ¬å·åŒ¹é…
  - âœ… é›†æˆåˆ° `make migrate_check`
- **æ–°å¢** `migrations/` ç›®å½•
  - âœ… åˆ›å»ºç¤ºä¾‹è¿ç§»è„šæœ¬
  - âœ… æ·»åŠ  README å’Œä½¿ç”¨è¯´æ˜

### âœ… 9. å¢å¼ºæ¨¡å—åˆå§‹åŒ–
- **å‡çº§** `scripts/ai_begin.sh`
  - âœ… ç”Ÿæˆæ‰€æœ‰å¿…å¤‡æ–‡æ¡£ï¼ˆå«å¼•å¯¼å†…å®¹ï¼‰
  - âœ… è‡ªåŠ¨è°ƒç”¨æµ‹è¯•è„šæ‰‹æ¶
  - âœ… è‡ªåŠ¨æ›´æ–°ç´¢å¼•
  - âœ… æä¾›å®Œæ•´çš„æ–‡æ¡£æ¨¡æ¿

### âœ… 10. æ›´æ–° agent.md
- âœ… å¢åŠ  S0 åˆ†å±‚ï¼ˆTier-0/1/2/3ï¼‰
- âœ… æ˜ç¡® plan.md ä¸ PROGRESS.md è¾¹ç•Œ
- âœ… æ›´æ–°å‘½ä»¤æ¸…å•
- âœ… æ›´æ–°é—¨ç¦è¯´æ˜

### âœ… 11. æ›´æ–° Makefile
- âœ… æ·»åŠ æ‰€æœ‰æ–°å‘½ä»¤
- âœ… å®ç° `make dev_check`ï¼ˆèšåˆæ‰€æœ‰æ£€æŸ¥ï¼‰
- âœ… æ·»åŠ å‘½ä»¤è¯´æ˜ï¼ˆ`make help`ï¼‰
- âœ… å®ç°å‚æ•°éªŒè¯

### âœ… 12. å®Œå–„ç¤ºä¾‹æ¨¡å—
- âœ… æ›´æ–° `modules/example/` æ‰€æœ‰æ–‡æ¡£
- âœ… æ·»åŠ è¯¦ç»†å¼•å¯¼å’Œç¤ºä¾‹
- âœ… æä¾›æœ€ä½³å®è·µå‚è€ƒ

## ğŸ“Š æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢è„šæœ¬ï¼ˆ8ä¸ªï¼‰
```
scripts/
â”œâ”€â”€ dag_check.py              # DAG æ ¡éªŒ
â”œâ”€â”€ contract_compat_check.py  # å¥‘çº¦å…¼å®¹æ€§
â”œâ”€â”€ consistency_check.py      # ä¸€è‡´æ€§æ£€æŸ¥
â”œâ”€â”€ rollback_check.sh         # å›æ»šéªŒè¯
â”œâ”€â”€ runtime_config_check.py   # è¿è¡Œæ—¶é…ç½®
â”œâ”€â”€ test_scaffold.py          # æµ‹è¯•è„šæ‰‹æ¶
â””â”€â”€ migrate_check.py          # è¿ç§»è„šæœ¬æ£€æŸ¥
```

### å‡çº§è„šæœ¬ï¼ˆ3ä¸ªï¼‰
```
scripts/
â”œâ”€â”€ docgen.py        # å¢å¼ºï¼šsummary/keywords/deps/hash
â”œâ”€â”€ ai_begin.sh      # å¢å¼ºï¼šå®Œæ•´æ¨¡æ¿ç”Ÿæˆ
â””â”€â”€ validate.sh      # é‡æ„ï¼šé›†æˆæ‰€æœ‰æ£€æŸ¥
```

### æ–°å¢ç›®å½•ï¼ˆ2ä¸ªï¼‰
```
migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬
.contracts_baseline/  # å¥‘çº¦åŸºçº¿
```

### æ›´æ–°æ–‡æ¡£
```
agent.md              # æ›´æ–°å·¥ä½œæµç¨‹
Makefile              # æ›´æ–°å‘½ä»¤
modules/example/*     # å®Œå–„æ‰€æœ‰æ–‡æ¡£
```

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

### 1. åˆ†å±‚ä¸Šä¸‹æ–‡åŠ è½½ï¼ˆS0ï¼‰
- **Tier-0ï¼ˆå¿…é¡»ï¼‰**ï¼šsnapshot.json, module_index.json
- **Tier-1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰**ï¼šdag.yaml, contract.json, plan.md
- **Tier-2ï¼ˆå»ºè®®ï¼‰**ï¼šDB_SPEC, ENV_SPEC, config
- **Tier-3ï¼ˆæŒ‰éœ€ï¼‰**ï¼šTEST_PLAN, RUNBOOK, PROGRESS

### 2. æ–‡æ¡£è¾¹ç•Œæ˜ç¡®
- `plan.md` = æœªæ¥ä¸€æ¬¡è¿­ä»£çš„è®¡åˆ’
- `PROGRESS.md` = å†å²è¿›åº¦ä¸é‡Œç¨‹ç¢‘
- CI è‡ªåŠ¨éªŒè¯äºŒè€…ä¸æ··ç”¨

### 3. å®Œæ•´çš„ CI é—¨ç¦
```bash
make dev_check  # èšåˆæ£€æŸ¥
â”œâ”€â”€ docgen                 # ç”Ÿæˆç´¢å¼•
â”œâ”€â”€ dag_check              # DAG æ ¡éªŒ
â”œâ”€â”€ contract_compat_check  # å¥‘çº¦å…¼å®¹æ€§
â”œâ”€â”€ runtime_config_check   # é…ç½®æ ¡éªŒ
â”œâ”€â”€ migrate_check          # è¿ç§»è„šæœ¬
â””â”€â”€ consistency_check      # ä¸€è‡´æ€§
```

### 4. å›æ»šéªŒè¯
```bash
make rollback_check PREV_REF=v0.1.0
```
- æ£€æŸ¥è¿ç§»è„šæœ¬æˆå¯¹
- éªŒè¯å›æ»šç›®æ ‡å­˜åœ¨
- æ£€æŸ¥ Feature Flag

### 5. å¥‘çº¦å˜æ›´ç®¡ç†
```bash
make contract_compat_check  # æ£€æŸ¥å…¼å®¹æ€§
make update_baselines       # æ›´æ–°åŸºçº¿
```
- ç ´åæ€§å˜æ›´è‡ªåŠ¨é˜»æ–­
- åŸºçº¿ç‰ˆæœ¬æ§åˆ¶

## ğŸš€ å¿«é€Ÿä½¿ç”¨æŒ‡å—

### é¦–æ¬¡åˆå§‹åŒ–
```bash
# ç”Ÿæˆç´¢å¼•
make docgen

# è¿è¡Œå®Œæ•´æ£€æŸ¥
make dev_check

# åˆå§‹åŒ–å¥‘çº¦åŸºçº¿
make update_baselines
```

### åˆ›å»ºæ–°æ¨¡å—
```bash
make ai_begin MODULE=my_module
# è‡ªåŠ¨ç”Ÿæˆï¼š
# - modules/my_module/*.md (8ä¸ªæ–‡æ¡£)
# - tests/my_module/ (æµ‹è¯•ç›®å½•)
# - æ›´æ–°ç´¢å¼•
```

### å¼€å‘æµç¨‹
```bash
# 1. æ›´æ–°è®¡åˆ’
vim modules/my_module/plan.md

# 2. å®ç°åŠŸèƒ½
# ... ç¼–å†™ä»£ç  ...

# 3. è¿è¡Œæ£€æŸ¥
make dev_check

# 4. æ›´æ–°ç´¢å¼•
make docgen

# 5. æäº¤å‰éªŒè¯
make dev_check
make rollback_check PREV_REF=main
```

### å¥‘çº¦å˜æ›´
```bash
# 1. ä¿®æ”¹å¥‘çº¦
vim tools/codegen/contract.json

# 2. æ£€æŸ¥å…¼å®¹æ€§
make contract_compat_check

# 3. é€šè¿‡åæ›´æ–°åŸºçº¿
make update_baselines
```

## ğŸ“¦ ä¾èµ–è¦æ±‚

### Python ä¾èµ–
```bash
pip install -r requirements.txt
```

### ç³»ç»Ÿè¦æ±‚
- Python 3.7+
- Bash 4.0+
- Gitï¼ˆç”¨äºå›æ»šéªŒè¯ï¼‰

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```bash
APP_ENV=dev|staging|prod  # è¿è¡Œç¯å¢ƒ
DATABASE_URL=...          # æ•°æ®åº“è¿æ¥ï¼ˆç”Ÿäº§å¿…éœ€ï¼‰
OPENAI_API_KEY=...        # API å¯†é’¥ï¼ˆç”Ÿäº§å¿…éœ€ï¼‰
```

### ç›®å½•ç»“æ„
```
.
â”œâ”€â”€ .aicontext/           # AI ä¸Šä¸‹æ–‡ç´¢å¼•
â”‚   â”œâ”€â”€ index.json        # æ–‡æ¡£ç´¢å¼•
â”‚   â”œâ”€â”€ snapshot.json     # å¿«ç…§å“ˆå¸Œ
â”‚   â””â”€â”€ module_index.json # æ¨¡å—ç´¢å¼•
â”œâ”€â”€ .contracts_baseline/  # å¥‘çº¦åŸºçº¿
â”œâ”€â”€ migrations/           # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ scripts/              # å·¥å…·è„šæœ¬
â””â”€â”€ modules/              # ä¸šåŠ¡æ¨¡å—
```

## âœ… éªŒè¯çŠ¶æ€

æ‰€æœ‰æ”¹è¿›å·²å®æ–½å¹¶éªŒè¯ï¼š
- [x] 13 ä¸ªæ”¹è¿›ç‚¹å…¨éƒ¨å®Œæˆ
- [x] æ‰€æœ‰è„šæœ¬å¯æ‰§è¡Œ
- [x] æ–‡æ¡£å®Œæ•´é½å…¨
- [x] Makefile å‘½ä»¤æ­£å¸¸
- [x] ç¤ºä¾‹æ¨¡å—æ›´æ–°å®Œæˆ

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**ï¼šéœ€è¦å…ˆæ‰§è¡Œ `make docgen` ç”Ÿæˆç´¢å¼•
2. **å¥‘çº¦åŸºçº¿**ï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦ `make update_baselines`
3. **Python ä¾èµ–**ï¼šéœ€è¦å®‰è£… `pip install -r requirements.txt`
4. **æƒé™é—®é¢˜**ï¼šè„šæœ¬éœ€è¦æ‰§è¡Œæƒé™ï¼ˆ`chmod +x scripts/*.sh`ï¼‰

## ğŸ‰ æ”¹è¿›æ•ˆæœ

1. **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šåˆ†å±‚åŠ è½½ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯»å–
2. **è´¨é‡é—¨ç¦**ï¼š7 ä¸ªè‡ªåŠ¨åŒ–æ£€æŸ¥ï¼Œå‡å°‘äººå·¥å®¡æŸ¥
3. **å¼€å‘æ•ˆç‡**ï¼šä¸€é”®åˆå§‹åŒ–æ¨¡å—ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£å’Œæµ‹è¯•
4. **æ–‡æ¡£è´¨é‡**ï¼šå®Œæ•´çš„æ¨¡æ¿å’Œå¼•å¯¼ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
5. **å›æ»šå®‰å…¨**ï¼šè‡ªåŠ¨åŒ–å›æ»šéªŒè¯ï¼Œé™ä½é£é™©
6. **å¥‘çº¦ç®¡ç†**ï¼šç ´åæ€§å˜æ›´è‡ªåŠ¨é˜»æ–­ï¼Œä¿æŠ¤ API å…¼å®¹æ€§

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `Agent-Repo-QA-Mapping.md` - æ”¹è¿›æ–¹æ¡ˆè¯¦ç»†è¯´æ˜
- `agent.md` - AI Agent å·¥ä½œæŒ‡å—
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `README.md` - é¡¹ç›®æ¦‚è¿°
- `modules/example/` - æ¨¡å—æ¨¡æ¿å‚è€ƒ

---

**å®æ–½æ—¥æœŸ**ï¼š2025-11-04  
**å®æ–½äººå‘˜**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šâœ… å…¨éƒ¨å®Œæˆ

