version: "1.0"
description: "AIæ™ºèƒ½ä½“è‡ªåŠ¨è§¦å‘è§„åˆ™ - åŸºäºæ–‡ä»¶è·¯å¾„å’Œpromptè‡ªåŠ¨åŠ è½½ç›¸å…³æ–‡æ¡£"

# å…¨å±€é…ç½®
config:
  enabled: true
  priority_order: ["critical", "high", "medium", "low"]
  enforcement_default: "suggest"  # suggest|warn|block
  
# è§¦å‘è§„åˆ™
triggers:
  # è§„åˆ™1: æ•°æ®åº“æ“ä½œè‡ªåŠ¨è§¦å‘
  database-operations:
    priority: high
    enforcement: suggest
    description: "æ•°æ®åº“æ“ä½œç›¸å…³æ–‡æ¡£"
    
    # æ–‡ä»¶è§¦å‘
    file_triggers:
      path_patterns:
        - "db/engines/**/*.sql"
        - "db/engines/**/*.yaml"
        - "migrations/**/*.sql"
        - "modules/*/models/**/*.py"
        - "modules/*/models/**/*.go"
        - "modules/*/models/**/*.ts"
      content_patterns:
        - "CREATE TABLE"
        - "ALTER TABLE"
        - "DROP TABLE"
        - "CREATE INDEX"
        - "prisma\\."
        - "async def.*query"
        - "db\\.query"
    
    # Promptè§¦å‘
    prompt_triggers:
      keywords:
        - "æ•°æ®åº“"
        - "database"
        - "è¿ç§»"
        - "migration"
        - "è¡¨ç»“æ„"
        - "schema"
        - "SQL"
      intent_patterns:
        - "(åˆ›å»º|ä¿®æ”¹|åˆ é™¤).{0,5}(è¡¨|å­—æ®µ|ç´¢å¼•)"
        - "(add|create|modify|delete).{0,10}(table|column|index)"
        - "(æ•°æ®åº“|database).{0,10}(æ“ä½œ|å˜æ›´)"
    
    # è§¦å‘æ—¶åŠ è½½çš„æ–‡æ¡£
    load_documents:
      - path: /doc/db/DB_SPEC.yaml
        priority: critical
      - path: /doc/db/SCHEMA_GUIDE.md
        priority: high
      - path: /doc/process/DB_CHANGE_GUIDE.md
        priority: high
      - path: /db/engines/README.md
        priority: medium

  # è§„åˆ™2: æ¨¡å—å¼€å‘è‡ªåŠ¨è§¦å‘
  module-development:
    priority: high
    enforcement: suggest
    description: "æ¨¡å—å¼€å‘ç›¸å…³æ–‡æ¡£"
    
    file_triggers:
      path_patterns:
        - "modules/*/agent.md"
        - "modules/*/README.md"
        - "modules/*/plan.md"
        - "modules/*/core/**/*"
        - "modules/*/api/**/*"
        - "modules/*/frontend/**/*"
      content_patterns:
        - "# agent.md"
        - "spec_version:"
        - "agent_id: \"modules\\."
    
    prompt_triggers:
      keywords:
        - "æ¨¡å—"
        - "module"
        - "åˆå§‹åŒ–æ¨¡å—"
        - "create module"
        - "æ–°å»ºæ¨¡å—"
        - "æ¨¡å—å¼€å‘"
      intent_patterns:
        - "(åˆ›å»º|åˆå§‹åŒ–|æ·»åŠ |å¼€å‘).{0,5}æ¨¡å—"
        - "(create|initialize|add|develop).{0,10}module"
    
    load_documents:
      - path: /doc/modules/MODULE_INIT_GUIDE.md
        priority: critical
      - path: /doc/modules/MODULE_TYPES.md
        priority: high
      - path: /doc/modules/MODULE_TYPE_CONTRACTS.yaml
        priority: high
      - path: /doc/modules/example/README.md
        priority: medium

  # è§„åˆ™3: å¥‘çº¦å˜æ›´ï¼ˆGuardrailæ¨¡å¼ï¼‰
  contract-changes:
    priority: critical
    enforcement: block  # â† å¼ºåˆ¶æ£€æŸ¥
    description: "å¥‘çº¦å˜æ›´å¿…é¡»éµå®ˆå…¼å®¹æ€§è§„åˆ™"
    
    file_triggers:
      path_patterns:
        - "tools/*/contract.json"
        - "modules/*/doc/CONTRACT.md"
        - "tools/openapi.json"
      content_patterns:
        - "# CONTRACT"
        - "\"contract_version\":"
    
    prompt_triggers:
      keywords:
        - "å¥‘çº¦"
        - "contract"
        - "APIå˜æ›´"
        - "æ¥å£å˜æ›´"
        - "breaking change"
      intent_patterns:
        - "(ä¿®æ”¹|å˜æ›´|æ›´æ–°).{0,5}(å¥‘çº¦|contract|API)"
        - "(change|modify|update).{0,10}(contract|API)"
    
    load_documents:
      - path: /doc/modules/MODULE_TYPE_CONTRACTS.yaml
        priority: critical
      - path: /doc/process/CONVENTIONS.md
        priority: high
    
    # Guardrailæ£€æŸ¥
    guardrail:
      - check: "make contract_compat_check"
        message: "å¿…é¡»è¿è¡Œå¥‘çº¦å…¼å®¹æ€§æ£€æŸ¥"
        enforcement: block
      - check: "ç¡®è®¤æ— ç ´åæ€§å˜æ›´æˆ–å·²å‡çº§majorç‰ˆæœ¬"
        message: "ç ´åæ€§å˜æ›´éœ€è¦å‡çº§majorç‰ˆæœ¬å·"
        enforcement: block

  # è§„åˆ™4: æµ‹è¯•å¼€å‘
  test-development:
    priority: medium
    enforcement: suggest
    description: "æµ‹è¯•å¼€å‘ç›¸å…³æ–‡æ¡£"
    
    file_triggers:
      path_patterns:
        - "tests/**/*.py"
        - "tests/**/*.go"
        - "tests/**/*.ts"
        - "modules/*/tests/**/*"
      content_patterns:
        - "def test_"
        - "func Test"
        - "describe\\("
        - "@pytest"
    
    prompt_triggers:
      keywords:
        - "æµ‹è¯•"
        - "test"
        - "å•å…ƒæµ‹è¯•"
        - "é›†æˆæµ‹è¯•"
        - "è¦†ç›–ç‡"
        - "coverage"
      intent_patterns:
        - "(ç¼–å†™|åˆ›å»º|æ·»åŠ ).{0,5}æµ‹è¯•"
        - "(write|create|add).{0,10}test"
    
    load_documents:
      - path: /doc/process/testing.md
        priority: critical
      - path: /doc/policies/quality_standards.md
        priority: high
      - path: /doc/modules/TEMPLATES/TEST_PLAN.md.template
        priority: medium

  # è§„åˆ™5: æ–‡æ¡£æ›´æ–°
  documentation:
    priority: medium
    enforcement: suggest
    description: "æ–‡æ¡£ç¼–å†™ç›¸å…³è§„èŒƒ"
    
    file_triggers:
      path_patterns:
        - "doc/**/*.md"
        - "modules/*/doc/**/*.md"
        - "README.md"
        - "CHANGELOG.md"
      content_patterns:
        - "^# "
        - "^## "
    
    prompt_triggers:
      keywords:
        - "æ–‡æ¡£"
        - "documentation"
        - "README"
        - "CHANGELOG"
        - "æ›´æ–°æ–‡æ¡£"
      intent_patterns:
        - "(ç¼–å†™|åˆ›å»º|æ›´æ–°).{0,5}æ–‡æ¡£"
        - "(write|create|update).{0,10}(document|README)"
    
    load_documents:
      - path: /agent.md
        priority: high
        note: "æŸ¥çœ‹Â§3 æ–‡æ¡£ç¼–å†™è§„èŒƒ"
      - path: /doc/policies/quality_standards.md
        priority: medium

  # è§„åˆ™6: é…ç½®ç®¡ç†
  configuration:
    priority: medium
    enforcement: suggest
    description: "é…ç½®æ–‡ä»¶ç›¸å…³æ–‡æ¡£"
    
    file_triggers:
      path_patterns:
        - "config/**/*.yaml"
        - "config/**/*.yml"
        - "config/**/*.json"
        - ".env*"
      content_patterns:
        - "^[A-Z_]+="
        - "environment:"
    
    prompt_triggers:
      keywords:
        - "é…ç½®"
        - "config"
        - "ç¯å¢ƒå˜é‡"
        - "environment"
      intent_patterns:
        - "(æ·»åŠ |ä¿®æ”¹|é…ç½®).{0,5}(é…ç½®|ç¯å¢ƒå˜é‡)"
        - "(add|modify|configure).{0,10}(config|environment)"
    
    load_documents:
      - path: /config/README.md
        priority: high
      - path: /doc/process/CONFIG_GUIDE.md
        priority: medium

  # è§„åˆ™7: éƒ¨ç½²ä¸å‘å¸ƒ
  deployment:
    priority: high
    enforcement: warn
    description: "éƒ¨ç½²å’Œå‘å¸ƒç›¸å…³æ–‡æ¡£"
    
    file_triggers:
      path_patterns:
        - ".github/workflows/**/*"
        - "docker-compose.yml"
        - "Dockerfile"
        - "deploy/**/*"
      content_patterns:
        - "deploy:"
        - "release:"
    
    prompt_triggers:
      keywords:
        - "éƒ¨ç½²"
        - "deploy"
        - "å‘å¸ƒ"
        - "release"
        - "ä¸Šçº¿"
      intent_patterns:
        - "(éƒ¨ç½²|å‘å¸ƒ|ä¸Šçº¿)"
        - "(deploy|release|publish)"
    
    load_documents:
      - path: /doc/project/RELEASE_TRAIN.md
        priority: critical
      - path: /doc/process/pr_workflow.md
        priority: high
    
    # Guardrailæ£€æŸ¥
    guardrail:
      - check: "make dev_check"
        message: "éƒ¨ç½²å‰å¿…é¡»é€šè¿‡æ‰€æœ‰æ£€æŸ¥"
        enforcement: warn
      - check: "make rollback_check"
        message: "é«˜é£é™©å˜æ›´éœ€è¦éªŒè¯å›æ»š"
        enforcement: warn

  # è§„åˆ™8: å®‰å…¨ç›¸å…³ï¼ˆBlockï¼‰
  security:
    priority: critical
    enforcement: block
    description: "å®‰å…¨ç›¸å…³æ“ä½œ"
    
    file_triggers:
      path_patterns:
        - "common/middleware/auth.py"
        - "common/utils/encryption.py"
        - "**/auth/**/*"
        - "**/security/**/*"
      content_patterns:
        - "password"
        - "secret"
        - "token"
        - "jwt"
        - "encrypt"
    
    prompt_triggers:
      keywords:
        - "å®‰å…¨"
        - "security"
        - "è®¤è¯"
        - "authentication"
        - "åŠ å¯†"
        - "encryption"
        - "å¯†ç "
        - "password"
      intent_patterns:
        - "(ä¿®æ”¹|æ·»åŠ ).{0,5}(å®‰å…¨|è®¤è¯|åŠ å¯†)"
        - "(modify|add).{0,10}(security|auth|encryption)"
    
    load_documents:
      - path: /doc/policies/safety.md
        priority: critical
      - path: /doc/policies/security_details.md
        priority: critical
    
    # Guardrailé…ç½®
    block_config:
      message: |
        âš ï¸ BLOCKED - å®‰å…¨ç›¸å…³æ“ä½œ
        
        ğŸ“‹ å®‰å…¨æ£€æŸ¥æ¸…å•:
        1. ç¦æ­¢ç¡¬ç¼–ç å¯†é’¥ã€å¯†ç ã€token
        2. æ•æ„Ÿä¿¡æ¯å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡æˆ–å¯†é’¥æœåŠ¡
        3. å¿…é¡»å…ˆé˜…è¯» doc/policies/security_details.md
        4. Code Reviewå¿…é¡»åŒ…å«å®‰å…¨å®¡æŸ¥
        
        ç»§ç»­å‰è¯·ç¡®è®¤å·²éµå®ˆæ‰€æœ‰å®‰å…¨è§„èŒƒã€‚
      
      require_confirmation: true
      confirmation_prompt: "å·²ç¡®è®¤éµå®ˆå®‰å…¨è§„èŒƒ? (yes/no)"

  # è§„åˆ™9: å¥‘çº¦å˜æ›´ï¼ˆBlockï¼‰
  contract-changes:
    priority: critical
    enforcement: block
    description: "API/æ¨¡å—å¥‘çº¦å˜æ›´"
    
    file_triggers:
      path_patterns:
        - "modules/*/doc/CONTRACT.md"
        - "schemas/**/*.yaml"
        - "openapi.json"
      content_patterns:
        - "## APIæ¥å£"
        - "### æ¥å£"
        - "endpoints:"
    
    prompt_triggers:
      keywords:
        - "å¥‘çº¦"
        - "contract"
        - "æ¥å£å˜æ›´"
        - "APIå˜æ›´"
        - "ç ´åæ€§å˜æ›´"
        - "breaking change"
      intent_patterns:
        - "(ä¿®æ”¹|å˜æ›´).{0,5}(å¥‘çº¦|æ¥å£|API)"
        - "(modify|change).{0,10}(contract|API|interface)"
    
    load_documents:
      - path: /doc/modules/MODULE_TYPE_CONTRACTS.yaml
        priority: critical
      - path: /doc/policies/quality_standards.md
        priority: high
    
    # Guardrailé…ç½®
    block_config:
      message: |
        âš ï¸ BLOCKED - å¥‘çº¦å˜æ›´æ£€æŸ¥
        
        ğŸ“‹ å¿…é¡»æ‰§è¡Œ:
        1. è¿è¡Œ: make contract_compat_check
        2. ç¡®è®¤æ— ç ´åæ€§å˜æ›´æˆ–å·²è§„åˆ’å…¼å®¹æ–¹æ¡ˆ
        3. æ›´æ–°CHANGELOG.mdè®°å½•å˜æ›´
        4. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆå¦‚éœ€è¦ï¼‰
        
        å¥‘çº¦å˜æ›´å½±å“ä¸‹æ¸¸æ¨¡å—ï¼Œéœ€è¦è°¨æ…å¤„ç†ã€‚
      
      skip_conditions:
        make_commands_passed:
          - "make contract_compat_check"
        or_env_var: "SKIP_CONTRACT_CHECK"

  # è§„åˆ™10: ç”Ÿäº§é…ç½®å˜æ›´ï¼ˆBlockï¼‰
  prod-config-changes:
    priority: critical
    enforcement: block
    description: "ç”Ÿäº§ç¯å¢ƒé…ç½®å˜æ›´"
    
    file_triggers:
      path_patterns:
        - "config/prod.yaml"
        - "config/staging.yaml"
        - ".env.production"
      content_patterns:
        - "prod"
        - "production"
        - "staging"
    
    prompt_triggers:
      keywords:
        - "ç”Ÿäº§é…ç½®"
        - "prod config"
        - "production"
        - "staging"
      intent_patterns:
        - "(ä¿®æ”¹|å˜æ›´).{0,5}(ç”Ÿäº§|prod|staging).{0,5}é…ç½®"
    
    load_documents:
      - path: /config/README.md
        priority: critical
      - path: /doc/process/CONFIG_GUIDE.md
        priority: high
      - path: /doc/policies/safety.md
        priority: high
    
    # Guardrailé…ç½®
    block_config:
      message: |
        âš ï¸ BLOCKED - ç”Ÿäº§é…ç½®å˜æ›´
        
        ğŸ“‹ å¿…é¡»æ‰§è¡Œ:
        1. è¿è¡Œ: make runtime_config_check
        2. Code Reviewï¼ˆè‡³å°‘2äººå®¡æ‰¹ï¼‰
        3. åœ¨stagingç¯å¢ƒå®Œæ•´æµ‹è¯•
        4. å‡†å¤‡å›æ»šæ–¹æ¡ˆ
        5. é€šçŸ¥è¿ç»´å›¢é˜Ÿ
        
        ç”Ÿäº§é…ç½®å˜æ›´æ˜¯é«˜é£é™©æ“ä½œï¼
      
      skip_conditions:
        env_var: "ALLOW_PROD_CONFIG"
        or_user_role: "admin"

  # è§„åˆ™11: æ ¹agent.mdå˜æ›´ï¼ˆWarnï¼‰
  root-agent-changes:
    priority: high
    enforcement: warn
    description: "æ ¹agent.mdå˜æ›´"
    
    file_triggers:
      path_patterns:
        - "agent.md"  # ä»…æ ¹ç›®å½•ï¼Œä¸åŒ…å«æ¨¡å—
      exclude_patterns:
        - "modules/*/agent.md"
    
    prompt_triggers:
      keywords:
        - "ä¿®æ”¹agent.md"
        - "æ›´æ–°agent"
        - "agenté…ç½®"
      intent_patterns:
        - "ä¿®æ”¹.{0,5}agent\\.md"
    
    load_documents:
      - path: /schemas/agent.schema.yaml
        priority: critical
      - path: /doc/orchestration/routing.md
        priority: high
    
    # Guardrailé…ç½®
    warn_config:
      message: |
        âš ï¸ WARNING - æ ¹agent.mdå˜æ›´
        
        è¿™æ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼å»ºè®®:
        1. è¿è¡Œ: make agent_lint
        2. è¿è¡Œ: make doc_route_check
        3. ç¡®è®¤æ‰€æœ‰è·¯ç”±æœ‰æ•ˆ
        4. é€šçŸ¥å›¢é˜Ÿæˆå‘˜
        
        ç»§ç»­?
      
      require_confirmation: true
      confirmation_prompt: "(yes/no)"

  # è§„åˆ™12: æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆBlockï¼‰
  database-migrations:
    priority: critical
    enforcement: block
    description: "æ•°æ®åº“è¿ç§»è„šæœ¬"
    
    file_triggers:
      path_patterns:
        - "db/engines/**/migrations/*_up.sql"
        - "db/engines/**/migrations/*_down.sql"
        - "migrations/*_up.sql"
        - "migrations/*_down.sql"
    
    prompt_triggers:
      keywords:
        - "è¿ç§»è„šæœ¬"
        - "migration script"
        - "æ•°æ®åº“è¿ç§»"
      intent_patterns:
        - "(åˆ›å»º|ä¿®æ”¹).{0,5}è¿ç§»è„šæœ¬"
    
    load_documents:
      - path: /doc/process/DB_CHANGE_GUIDE.md
        priority: critical
      - path: /doc/process/resources/db-migration-script.md
        priority: high
    
    # Guardrailé…ç½®
    block_config:
      message: |
        âš ï¸ BLOCKED - æ•°æ®åº“è¿ç§»è„šæœ¬
        
        ğŸ“‹ å¿…é¡»æ‰§è¡Œ:
        1. ç¡®è®¤upå’Œdownè„šæœ¬æˆå¯¹å­˜åœ¨
        2. ç¡®è®¤è„šæœ¬å…·æœ‰å¹‚ç­‰æ€§ï¼ˆå¯é‡å¤æ‰§è¡Œï¼‰
        3. è¿è¡Œ: make db_lint
        4. åœ¨devç¯å¢ƒæµ‹è¯•upè„šæœ¬
        5. åœ¨devç¯å¢ƒæµ‹è¯•downè„šæœ¬ï¼ˆå›æ»šï¼‰
        6. æ·»åŠ é€‚å½“çš„äº‹åŠ¡æ§åˆ¶
        
        è¿ç§»è„šæœ¬é”™è¯¯å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼
      
      skip_conditions:
        make_commands_passed:
          - "make db_lint"
        and_confirmation: true

  # è§„åˆ™13: Registryå˜æ›´ï¼ˆWarnï¼‰
  registry-changes:
    priority: high
    enforcement: warn
    description: "æ¨¡å—æ³¨å†Œè¡¨å˜æ›´"
    
    file_triggers:
      path_patterns:
        - "doc/orchestration/registry.yaml"
    
    prompt_triggers:
      keywords:
        - "registry"
        - "æ³¨å†Œè¡¨"
        - "æ¨¡å—æ³¨å†Œ"
      intent_patterns:
        - "(ä¿®æ”¹|æ›´æ–°).{0,5}(registry|æ³¨å†Œè¡¨)"
    
    load_documents:
      - path: /doc/orchestration/registry.yaml
        priority: critical
      - path: /doc/modules/MODULE_INIT_GUIDE.md
        priority: high
    
    # Guardrailé…ç½®
    warn_config:
      message: |
        âš ï¸ WARNING - Registryå˜æ›´
        
        å»ºè®®:
        1. è¿è¡Œ: make registry_check
        2. ç¡®è®¤æ¨¡å—è·¯å¾„å­˜åœ¨
        3. ç¡®è®¤ä¾èµ–å…³ç³»æ— å¾ªç¯
        
        ç»§ç»­?
      
      require_confirmation: true

# å…ƒæ•°æ®
meta:
  version: "1.0"
  created: "2025-11-08"
  last_updated: "2025-11-08"
  author: "AI-TEMPLATE Phase 10"
  related_docs:
    - /doc/orchestration/routing.md
    - /doc/orchestration/triggers-guide.md
    - /agent.md

