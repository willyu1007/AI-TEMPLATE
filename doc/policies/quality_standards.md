# è´¨é‡é—¨æ§›æ ‡å‡†

> **ç”¨é€”**: å®šä¹‰ä»£ç å’Œæ–‡æ¡£çš„è´¨é‡è¦æ±‚  
> **ç‰ˆæœ¬**: 1.0  
> **åˆ›å»ºæ—¶é—´**: 2025-11-08

---

## 1. æµ‹è¯•è¦æ±‚è¯¦è§£

### 1.1 æµ‹è¯•ç±»å‹

#### å¿…éœ€çš„æµ‹è¯•ï¼ˆ3ç§ï¼‰
```yaml
quality_gates:
  required_tests:
    - unit           # å•å…ƒæµ‹è¯•ï¼ˆå¿…éœ€ï¼‰
    - integration    # é›†æˆæµ‹è¯•ï¼ˆå¿…éœ€ï¼‰
    - contract       # å¥‘çº¦æµ‹è¯•ï¼ˆå¿…éœ€ï¼‰
```

**å•å…ƒæµ‹è¯•**:
- æµ‹è¯•å•ä¸ªå‡½æ•°/æ–¹æ³•
- æ— å¤–éƒ¨ä¾èµ–ï¼ˆMockå¤–éƒ¨è°ƒç”¨ï¼‰
- å¿«é€Ÿæ‰§è¡Œï¼ˆ<1ç§’/æµ‹è¯•ï¼‰
- è¦†ç›–æ ¸å¿ƒé€»è¾‘

**é›†æˆæµ‹è¯•**:
- æµ‹è¯•æ¨¡å—é—´äº¤äº’
- åŒ…å«çœŸå®ä¾èµ–ï¼ˆæ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡ï¼‰
- ä¸­é€Ÿæ‰§è¡Œï¼ˆ1-10ç§’/æµ‹è¯•ï¼‰
- è¦†ç›–ä¸»è¦æµç¨‹

**å¥‘çº¦æµ‹è¯•**:
- éªŒè¯CONTRACT.mdå®šä¹‰
- æµ‹è¯•è¾“å…¥è¾“å‡ºæ ¼å¼
- æµ‹è¯•é”™è¯¯ç 
- ä¿è¯å‘åå…¼å®¹

---

#### å¯é€‰çš„æµ‹è¯•ï¼ˆ4ç§ï¼‰
```yaml
optional_tests:
  - e2e              # ç«¯åˆ°ç«¯æµ‹è¯•
  - smoke            # å†’çƒŸæµ‹è¯•
  - performance      # æ€§èƒ½æµ‹è¯•
  - security         # å®‰å…¨æµ‹è¯•
```

---

### 1.2 è¦†ç›–ç‡è¦æ±‚

**é»˜è®¤è¦æ±‚**: 80%

**é…ç½®æ–¹å¼**:
```yaml
# modules/<module>/agent.md
quality_gates:
  coverage_min: 0.80     # æœ€ä½80%
  coverage_target: 0.90  # ç›®æ ‡90%
```

**è¦†ç›–ç‡è®¡ç®—**:
- è¡Œè¦†ç›–ç‡ï¼ˆLine Coverageï¼‰
- åˆ†æ”¯è¦†ç›–ç‡ï¼ˆBranch Coverageï¼‰
- å‡½æ•°è¦†ç›–ç‡ï¼ˆFunction Coverageï¼‰

**æ ¡éªŒ**:
```bash
make test_status_check
# è¾“å‡º: å½“å‰è¦†ç›–ç‡ vs è¦æ±‚è¦†ç›–ç‡
```

---

### 1.3 æµ‹è¯•æ•°æ®ç®¡ç†

**Fixturesç®¡ç†**:
```bash
# åŠ è½½æµ‹è¯•æ•°æ®
make load_fixture MODULE=user FIXTURE=minimal

# è¿è¡Œæµ‹è¯•
make test

# æ¸…ç†æµ‹è¯•æ•°æ®
make cleanup_fixture MODULE=user
```

**Mockæ•°æ®ç®¡ç†**:
```bash
# ç”ŸæˆMockæ•°æ®
make generate_mock MODULE=user TABLE=users COUNT=1000

# è¿è¡Œæ€§èƒ½æµ‹è¯•
make test_performance

# æ¸…ç†Mockæ•°æ®
make cleanup_mocks
```

---

## 2. æ–‡æ¡£è¦æ±‚è¯¦è§£

### 2.1 å¿…éœ€çš„æ¨¡å—æ–‡æ¡£

**æ ‡å‡†6æ–‡æ¡£**:
```
modules/<entity>/doc/
â”œâ”€â”€ CONTRACT.md     âœ… APIå¥‘çº¦ï¼ˆè¾“å…¥è¾“å‡ºã€é”™è¯¯ç ï¼‰
â”œâ”€â”€ CHANGELOG.md    âœ… å˜æ›´è®°å½•ï¼ˆæ¯æ¬¡å‘å¸ƒæ›´æ–°ï¼‰
â”œâ”€â”€ RUNBOOK.md      âœ… è¿ç»´æ‰‹å†Œï¼ˆéƒ¨ç½²ã€ç›‘æ§ã€æ•…éšœå¤„ç†ï¼‰
â”œâ”€â”€ BUGS.md         âœ… å·²çŸ¥é—®é¢˜ï¼ˆé—®é¢˜è¿½è¸ªï¼‰
â”œâ”€â”€ PROGRESS.md     âœ… è¿›åº¦è¿½è¸ªï¼ˆå¼€å‘è¿›åº¦ï¼‰
â””â”€â”€ TEST_PLAN.md    âœ… æµ‹è¯•è®¡åˆ’ï¼ˆæµ‹è¯•ç­–ç•¥ï¼‰
```

**å¯é€‰æ–‡æ¡£**:
- TEST_DATA.md: æµ‹è¯•æ•°æ®è§„æ ¼ï¼ˆå¦‚æœ‰å¤æ‚æµ‹è¯•éœ€æ±‚ï¼‰
- MIGRATION.md: è¿ç§»æŒ‡å—ï¼ˆå¦‚æœ‰ç ´åæ€§å˜æ›´ï¼‰
- FAQ.md: å¸¸è§é—®é¢˜

---

### 2.2 æ–‡æ¡£è´¨é‡æ ‡å‡†

**CONTRACT.mdè¦æ±‚**:
- âœ… æ˜ç¡®çš„è¾“å…¥è¾“å‡ºæ ¼å¼
- âœ… å®Œæ•´çš„é”™è¯¯ç å®šä¹‰
- âœ… è°ƒç”¨ç¤ºä¾‹
- âœ… ç‰ˆæœ¬ä¿¡æ¯

**CHANGELOG.mdè¦æ±‚**:
- âœ… æŒ‰ç‰ˆæœ¬ç»„ç»‡
- âœ… åˆ†ç±»è®°å½•ï¼ˆAdded/Changed/Deprecated/Removed/Fixed/Securityï¼‰
- âœ… åŒ…å«æ—¥æœŸå’Œä½œè€…
- âœ… é‡å¤§å˜æ›´çªå‡ºæ ‡è®°

**RUNBOOK.mdè¦æ±‚**:
- âœ… éƒ¨ç½²æ­¥éª¤
- âœ… ç›‘æ§æŒ‡æ ‡
- âœ… å¸¸è§æ•…éšœå¤„ç†
- âœ… å›æ»šæµç¨‹

---

### 2.3 æ–‡æ¡£åŒæ­¥è¦æ±‚

**ä»£ç å˜æ›´æ—¶å¿…é¡»åŒæ­¥æ›´æ–°**:
```
ä¿®æ”¹æ¥å£ â†’ æ›´æ–°CONTRACT.md
æ·»åŠ åŠŸèƒ½ â†’ æ›´æ–°CHANGELOG.mdï¼ˆAddedï¼‰
ä¿®å¤Bug â†’ æ›´æ–°CHANGELOG.mdï¼ˆFixedï¼‰+ BUGS.md
ä¼˜åŒ–æ€§èƒ½ â†’ æ›´æ–°CHANGELOG.mdï¼ˆChangedï¼‰
```

**æ ¡éªŒæœºåˆ¶**:
```bash
make consistency_check
# æ£€æŸ¥: æ˜¯å¦æœ‰ä»£ç å˜æ›´ä½†æ–‡æ¡£æœªæ›´æ–°
```

---

## 3. å…¼å®¹æ€§è¦æ±‚è¯¦è§£

### 3.1 APIå¥‘çº¦å…¼å®¹æ€§

**å‘åå…¼å®¹åŸåˆ™**:
1. **ä¸åˆ é™¤ç°æœ‰å­—æ®µ** - åºŸå¼ƒå­—æ®µæ ‡è®°@deprecated
2. **ä¸æ”¹å˜å­—æ®µç±»å‹** - å¦‚éœ€æ”¹å˜ï¼Œåˆ›å»ºæ–°å­—æ®µ
3. **ä¸æ”¹å˜å­—æ®µè¯­ä¹‰** - å¦‚éœ€æ”¹å˜ï¼Œå‡çº§majorç‰ˆæœ¬

**ç¤ºä¾‹**:
```json
// âŒ é”™è¯¯: åˆ é™¤å­—æ®µ
{
  "name": "user",
  // "email": "user@example.com"  // åˆ é™¤äº†emailå­—æ®µ
}

// âœ… æ­£ç¡®: åºŸå¼ƒå­—æ®µ
{
  "name": "user",
  "email": "user@example.com",  // @deprecated: ä½¿ç”¨email_addressæ›¿ä»£
  "email_address": "user@example.com"
}
```

---

### 3.2 æ•°æ®åº“å…¼å®¹æ€§

**å‘åå…¼å®¹ç­–ç•¥**:

**æ·»åŠ åˆ—**ï¼ˆå…¼å®¹ï¼‰:
```sql
-- âœ… å…è®¸: æ·»åŠ å¯ç©ºåˆ—
ALTER TABLE users ADD COLUMN nickname TEXT NULL;

-- âš ï¸ è°¨æ…: æ·»åŠ éç©ºåˆ—ï¼ˆéœ€æä¾›é»˜è®¤å€¼ï¼‰
ALTER TABLE users ADD COLUMN status TEXT NOT NULL DEFAULT 'active';
```

**ä¿®æ”¹åˆ—**ï¼ˆç ´åæ€§ï¼‰:
```sql
-- âŒ ç¦æ­¢: ç›´æ¥ä¿®æ”¹åˆ—ç±»å‹
ALTER TABLE users ALTER COLUMN age TYPE BIGINT;

-- âœ… æ­£ç¡®: åˆ†æ­¥è¿ç§»
-- 1. æ·»åŠ æ–°åˆ—
ALTER TABLE users ADD COLUMN age_new BIGINT;
-- 2. æ•°æ®è¿ç§»
UPDATE users SET age_new = age::BIGINT;
-- 3. åˆ é™¤æ—§åˆ—ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
ALTER TABLE users DROP COLUMN age;
ALTER TABLE users RENAME COLUMN age_new TO age;
```

**åˆ é™¤åˆ—**ï¼ˆç ´åæ€§ï¼‰:
```sql
-- âŒ ç¦æ­¢: ç›´æ¥åˆ é™¤åˆ—
ALTER TABLE users DROP COLUMN email;

-- âœ… æ­£ç¡®: åˆ†æ­¥åºŸå¼ƒ
-- ç‰ˆæœ¬1: æ ‡è®°åºŸå¼ƒï¼ˆæ–‡æ¡£ä¸­ï¼‰
-- ç‰ˆæœ¬2: åœæ­¢ä½¿ç”¨ï¼ˆä»£ç ä¸­ï¼‰
-- ç‰ˆæœ¬3: åˆ é™¤åˆ—ï¼ˆç¡®è®¤æ— å¼•ç”¨åï¼‰
```

---

### 3.3 å…¼å®¹æ€§æ£€æŸ¥

**å¥‘çº¦å…¼å®¹æ€§**:
```bash
make contract_compat_check
# å¯¹æ¯”: å½“å‰CONTRACT vs åŸºçº¿CONTRACT
# æ£€æŸ¥: æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´
```

**æ•°æ®åº“å…¼å®¹æ€§**:
```bash
make rollback_check PREV_REF=v1.0.0
# æµ‹è¯•: æ‰§è¡Œup â†’ æ‰§è¡Œdown â†’ éªŒè¯å›æ»šæˆåŠŸ
```

---

## 4. ä»£ç è§„èŒƒè¯¦è§£

### 4.1 å‘½åè§„èŒƒ

**æ¨¡å—å**:
```
æ ¼å¼: å°å†™å­—æ¯ + ä¸‹åˆ’çº¿
ç¤ºä¾‹:
  âœ… user_auth
  âœ… order_management
  âŒ UserAuthï¼ˆé©¼å³°ï¼‰
  âŒ user-authï¼ˆè¿å­—ç¬¦ï¼‰
```

**ç±»å**:
```
æ ¼å¼: å¤§é©¼å³°ï¼ˆPascalCaseï¼‰
ç¤ºä¾‹:
  âœ… UserService
  âœ… OrderRepository
  âŒ user_serviceï¼ˆè›‡å½¢ï¼‰
  âŒ userServiceï¼ˆå°é©¼å³°ï¼‰
```

**å‡½æ•°å**:
```
Python: è›‡å½¢ï¼ˆsnake_caseï¼‰
  âœ… get_user_by_id()
  âœ… create_order()

JavaScript/TypeScript: å°é©¼å³°ï¼ˆcamelCaseï¼‰
  âœ… getUserById()
  âœ… createOrder()

Go: å°é©¼å³°ï¼ˆé¦–å­—æ¯å†³å®šå¯è§æ€§ï¼‰
  âœ… getUserByID()  // ç§æœ‰
  âœ… GetUserByID()  // å…¬å¼€
```

**å¸¸é‡**:
```
æ ¼å¼: å¤§å†™ + ä¸‹åˆ’çº¿
ç¤ºä¾‹:
  âœ… MAX_RETRY_COUNT = 3
  âœ… DEFAULT_TIMEOUT_MS = 5000
  âŒ maxRetryCountï¼ˆå°é©¼å³°ï¼‰
```

---

### 4.2 æ–‡æ¡£é£æ ¼è§„èŒƒ

**è¯­è¨€ä¸€è‡´æ€§**:
- âœ… åŒä¸€æ–‡æ¡£ç»Ÿä¸€è¯­è¨€ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰
- âŒ ä¸æ··ç”¨ä¸­è‹±æ–‡å¥å­
- âœ… æŠ€æœ¯æœ¯è¯­ä¿æŒè‹±æ–‡ï¼ˆAPIã€HTTPã€SQLï¼‰

**ç¤ºä¾‹**:
```markdown
âŒ é”™è¯¯: æ··ç”¨
è¿™ä¸ªAPIæä¾›user managementåŠŸèƒ½ã€‚

âœ… æ­£ç¡®: ç»Ÿä¸€
è¿™ä¸ªAPIæä¾›ç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚
æˆ–
This API provides user management functionality.
```

**æ— é¢œæ–‡å­—**:
- âœ… å…è®¸: çŠ¶æ€æ ‡è®°ï¼ˆâœ… âŒ âš ï¸ â³ï¼‰
- âŒ ç¦æ­¢: è£…é¥°æ€§emojiï¼ˆğŸš€ ğŸ’¡ ğŸ“¦ ğŸ”§ç­‰ï¼‰

**ç»“æ„åŒ–**:
- âœ… ä½¿ç”¨æ ‡é¢˜å±‚çº§ï¼ˆ#ã€##ã€###ï¼‰
- âœ… ä½¿ç”¨åˆ—è¡¨ï¼ˆ-, 1. 2. 3.ï¼‰
- âœ… ä½¿ç”¨è¡¨æ ¼ï¼ˆå¯¹æ¯”ã€å‚æ•°è¯´æ˜ï¼‰
- âœ… ä½¿ç”¨ä»£ç å—ï¼ˆ```è¯­è¨€ï¼‰

---

### 4.3 ä»£ç è´¨é‡æ ‡å‡†

**å¤æ‚åº¦æ§åˆ¶**:
```
å‡½æ•°å¤æ‚åº¦: â‰¤10ï¼ˆåœˆå¤æ‚åº¦ï¼‰
æ–‡ä»¶è¡Œæ•°: â‰¤500è¡Œ
ç±»è¡Œæ•°: â‰¤300è¡Œ
å‡½æ•°è¡Œæ•°: â‰¤50è¡Œ
```

**æ³¨é‡Šè¦æ±‚**:
```python
# âœ… å…¬å¼€æ¥å£: å¿…é¡»æœ‰docstring
def create_user(name: str, email: str) -> User:
    """
    åˆ›å»ºç”¨æˆ·
    
    Args:
        name: ç”¨æˆ·å
        email: é‚®ç®±åœ°å€
    
    Returns:
        Userå¯¹è±¡
    
    Raises:
        ValidationError: å‚æ•°éªŒè¯å¤±è´¥
    """
    pass

# âœ… ç§æœ‰å‡½æ•°: å¯é€‰docstringï¼ˆä½†å¤æ‚é€»è¾‘éœ€è¦ï¼‰
def _validate_email(email: str) -> bool:
    """éªŒè¯é‚®ç®±æ ¼å¼"""
    pass

# âœ… å¤æ‚é€»è¾‘: éœ€è¦æ³¨é‡Š
# ä½¿ç”¨å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦è§£é‡Š
pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
```

---

## 8. è´¨é‡é—¨ç¦

### å¼€å‘é˜¶æ®µï¼ˆè­¦å‘Šæ¨¡å¼ï¼‰
```bash
make dev_check
# ä¸é€šè¿‡æ—¶: æ˜¾ç¤ºè­¦å‘Šï¼Œä½†å…è®¸ç»§ç»­å¼€å‘
```

### æäº¤é˜¶æ®µï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
```bash
# CIè‡ªåŠ¨è¿è¡Œ
make validate
# ä¸é€šè¿‡æ—¶: æ‹’ç»åˆå¹¶ï¼Œå¿…é¡»ä¿®å¤
```

### ç”Ÿäº§é˜¶æ®µï¼ˆå¼ºåˆ¶æ¨¡å¼ï¼‰
```bash
# éƒ¨ç½²å‰æ£€æŸ¥
make validate
make test
make rollback_check
# ä»»ä½•å¤±è´¥: é˜»æ–­éƒ¨ç½²
```

---

**ç»´æŠ¤**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´æ ‡å‡†  
**å®¡æ ¸**: æ¯å­£åº¦å®¡æ ¸ä¸€æ¬¡ï¼Œç¡®ä¿æ ‡å‡†åˆç†

