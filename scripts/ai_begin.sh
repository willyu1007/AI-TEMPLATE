#!/usr/bin/env bash
set -euo pipefail

MOD=${1:-}

if [ -z "$MOD" ]; then
    echo "ç”¨æ³•: bash scripts/ai_begin.sh <module>"
    echo "ç¤ºä¾‹: bash scripts/ai_begin.sh user_auth"
    exit 1
fi

echo "ðŸš€ åˆå§‹åŒ–æ¨¡å—: $MOD"
echo ""

# åˆ›å»ºæ¨¡å—ç›®å½•
mkdir -p "modules/$MOD"

# ç”Ÿæˆæ¨¡å—æ–‡æ¡£ï¼ˆå¸¦å¼•å¯¼å†…å®¹ï¼‰
echo "[1/4] ç”Ÿæˆæ¨¡å—æ–‡æ¡£..."

# README.md
cat > "modules/$MOD/README.md" <<'EOF'
# <æ¨¡å—å> æ¨¡å—

## èŒè´£
æè¿°æ­¤æ¨¡å—çš„æ ¸å¿ƒèŒè´£å’ŒåŠŸèƒ½èŒƒå›´ã€‚

## è¾¹ç•Œ
### è¾“å…¥
- æ¥è‡ªå“ªäº›æ¨¡å—/æœåŠ¡çš„æ•°æ®
- æœŸæœ›çš„è¾“å…¥æ ¼å¼

### è¾“å‡º
- äº§å‡ºä»€ä¹ˆæ•°æ®
- è¾“å‡ºåˆ°å“ªé‡Œ

### ä¾èµ–
- å·¥å…·ï¼šåˆ—å‡ºä½¿ç”¨çš„å·¥å…·/æœåŠ¡
- æ¨¡å—ï¼šåˆ—å‡ºä¾èµ–çš„å…¶ä»–æ¨¡å—

## æž¶æž„
ç®€è¦æè¿°æ¨¡å—å†…éƒ¨ç»“æž„å’Œå…³é”®ç»„ä»¶ã€‚

## è¿è¡Œè¦æ±‚
- çŽ¯å¢ƒå˜é‡
- é…ç½®é¡¹
- å¤–éƒ¨ä¾èµ–
EOF

# plan.md
cat > "modules/$MOD/plan.md" <<EOF
# è®¡åˆ’ ($(date +%Y-%m-%d))

## ç›®æ ‡
æ˜Žç¡®æœ¬æ¬¡è¿­ä»£è¦å®žçŽ°çš„åŠŸèƒ½æˆ–è§£å†³çš„é—®é¢˜ã€‚

## èŒƒå›´
- åŒ…å«ï¼šåˆ—å‡ºè¦åšçš„äº‹æƒ…
- ä¸åŒ…å«ï¼šæ˜Žç¡®ä¸åšä»€ä¹ˆï¼ˆé¿å…èŒƒå›´è”“å»¶ï¼‰

## æŽ¥å£/DB å½±å“
- æ–°å¢ž/ä¿®æ”¹çš„æŽ¥å£ï¼š
- æ•°æ®åº“å˜æ›´ï¼š
- DAG èŠ‚ç‚¹å˜æ›´ï¼š

## æµ‹è¯•æ¸…å•
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•

## éªŒè¯å‘½ä»¤
\`\`\`bash
make dev_check
# å…¶ä»–éªŒè¯å‘½ä»¤
\`\`\`

## å›žæ»šè®¡åˆ’
å¦‚æžœå‡ºçŽ°é—®é¢˜ï¼Œå¦‚ä½•å›žæ»šï¼Ÿ
- æ•°æ®åº“è¿ç§»å›žæ»šï¼š
- ä»£ç å›žæ»šï¼š
- Feature Flagï¼š
EOF

# CONTRACT.md
cat > "modules/$MOD/CONTRACT.md" <<'EOF'
# CONTRACT - æŽ¥å£å¥‘çº¦

## è¾“å…¥
```json
{
  "field1": "ç±»åž‹å’Œè¯´æ˜Ž",
  "field2": "ç±»åž‹å’Œè¯´æ˜Ž"
}
```

## è¾“å‡º
```json
{
  "result": "ç±»åž‹å’Œè¯´æ˜Ž",
  "status": "success|error"
}
```

## é”™è¯¯ç 
- `E001`: é”™è¯¯è¯´æ˜Ž
- `E002`: é”™è¯¯è¯´æ˜Ž

## å…¼å®¹ç­–ç•¥
- å‘åŽå…¼å®¹ï¼šä¸åˆ é™¤å­—æ®µï¼Œä¸æ”¹å˜ç±»åž‹
- ç‰ˆæœ¬ç®¡ç†ï¼šsemver

## ç¤ºä¾‹
### è¯·æ±‚ç¤ºä¾‹
```json
{
  "field1": "example"
}
```

### å“åº”ç¤ºä¾‹
```json
{
  "result": "example",
  "status": "success"
}
```
EOF

# TEST_PLAN.md
cat > "modules/$MOD/TEST_PLAN.md" <<'EOF'
# TEST_PLAN - æµ‹è¯•è®¡åˆ’

## å…³é”®è·¯å¾„ç”¨ä¾‹
1. **ç”¨ä¾‹1**ï¼šæ­£å¸¸æµç¨‹
   - è¾“å…¥ï¼š
   - æœŸæœ›è¾“å‡ºï¼š
   - éªŒè¯ç‚¹ï¼š

2. **ç”¨ä¾‹2**ï¼šå¼‚å¸¸å¤„ç†
   - è¾“å…¥ï¼š
   - æœŸæœ›è¾“å‡ºï¼š
   - éªŒè¯ç‚¹ï¼š

## å¥‘çº¦æµ‹è¯•
- è¾“å…¥éªŒè¯
- è¾“å‡ºæ ¼å¼éªŒè¯
- é”™è¯¯ç æµ‹è¯•

## è¾¹ç•Œæµ‹è¯•
- ç©ºå€¼
- æžç«¯å€¼
- å¹¶å‘åœºæ™¯

## å›žå½’æµ‹è¯•
åˆ—å‡ºæ¯æ¬¡å¿…é¡»è¿è¡Œçš„å›žå½’ç”¨ä¾‹ã€‚
EOF

# RUNBOOK.md
cat > "modules/$MOD/RUNBOOK.md" <<'EOF'
# RUNBOOK - è¿ç»´æ‰‹å†Œ

## å¯åŠ¨
```bash
# å¯åŠ¨å‘½ä»¤
```

## è°ƒè¯•
- æ—¥å¿—ä½ç½®ï¼š
- å¸¸è§é—®é¢˜æŽ’æŸ¥ï¼š
- è°ƒè¯•å·¥å…·ï¼š

## å‘Šè­¦
| å‘Šè­¦åç§° | è§¦å‘æ¡ä»¶ | å¤„ç†æ­¥éª¤ |
|---------|---------|---------|
| Alert1  | æ¡ä»¶    | æ­¥éª¤    |

## å›žæ»š
```bash
# å›žæ»šæ­¥éª¤
```

## ç›‘æŽ§æŒ‡æ ‡
- å…³é”®æŒ‡æ ‡1ï¼š
- å…³é”®æŒ‡æ ‡2ï¼š
EOF

# PROGRESS.md
cat > "modules/$MOD/PROGRESS.md" <<EOF
# PROGRESS - è¿›åº¦ä¸Žé‡Œç¨‹ç¢‘

## å½“å‰çŠ¶æ€
- çŠ¶æ€ï¼šè§„åˆ’ä¸­ / å¼€å‘ä¸­ / æµ‹è¯•ä¸­ / å·²å®Œæˆ
- æœ€åŽæ›´æ–°ï¼š$(date +%Y-%m-%d)

## é‡Œç¨‹ç¢‘
- [ ] M1: åŸºç¡€åŠŸèƒ½ (ç›®æ ‡æ—¥æœŸ)
- [ ] M2: å®Œæ•´åŠŸèƒ½ (ç›®æ ‡æ—¥æœŸ)
- [ ] M3: ä¼˜åŒ–ä¸Žå‘å¸ƒ (ç›®æ ‡æ—¥æœŸ)

## é˜»å¡žé¡¹
åˆ—å‡ºé˜»å¡žè¿›åº¦çš„é—®é¢˜ã€‚

## å·²å®Œæˆ
- $(date +%Y-%m-%d): åˆå§‹åŒ–æ¨¡å—
EOF

# BUGS.md
cat > "modules/$MOD/BUGS.md" <<'EOF'
# BUGS - ç¼ºé™·è·Ÿè¸ª

## å·²çŸ¥ç¼ºé™·
- [ ] **BUG-001**: ç¼ºé™·æè¿°
  - å½±å“ï¼šä¸¥é‡ç¨‹åº¦
  - å¤çŽ°æ­¥éª¤ï¼š
  - ä¸´æ—¶æ–¹æ¡ˆï¼š

## å·²ä¿®å¤
- [x] **BUG-000**: ç¤ºä¾‹ç¼ºé™·ï¼ˆå·²ä¿®å¤ï¼‰
  - ä¿®å¤æ—¶é—´ï¼šYYYY-MM-DD
  - ä¿®å¤æ–¹æ¡ˆï¼š

## å¤ç›˜
å¯¹é‡è¦ç¼ºé™·çš„æ ¹å› åˆ†æžå’Œæ”¹è¿›æŽªæ–½ã€‚
EOF

# CHANGELOG.md
cat > "modules/$MOD/CHANGELOG.md" <<EOF
# CHANGELOG - å˜æ›´æ—¥å¿—

## [Unreleased]

## [0.1.0] - $(date +%Y-%m-%d)
### Added
- åˆå§‹åŒ–æ¨¡å—ç»“æž„
- åˆ›å»ºåŸºç¡€æ–‡æ¡£

### Changed
-

### Fixed
-

### Removed
-
EOF

echo "  âœ“ æ¨¡å—æ–‡æ¡£å·²ç”Ÿæˆ"

# ç”Ÿæˆæµ‹è¯•è„šæ‰‹æž¶
echo "[2/4] ç”Ÿæˆæµ‹è¯•è„šæ‰‹æž¶..."
python scripts/test_scaffold.py "$MOD"

# æ›´æ–°ç´¢å¼•
echo "[3/4] æ›´æ–°ç´¢å¼•..."
python scripts/docgen.py

# æç¤ºä¸‹ä¸€æ­¥
echo ""
echo "[4/4] å®Œæˆï¼"
echo ""
echo "âœ… æ¨¡å— '$MOD' åˆå§‹åŒ–å®Œæˆ"
echo ""
echo "ðŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶ï¼š"
echo "   - modules/$MOD/*.md (8ä¸ªæ–‡æ¡£)"
echo "   - tests/$MOD/ (æµ‹è¯•ç›®å½•)"
echo ""
echo "ðŸ’¡ ä¸‹ä¸€æ­¥ï¼š"
echo "   1. ç¼–è¾‘ modules/$MOD/plan.md å®šä¹‰ä»»åŠ¡è®¡åˆ’"
echo "   2. å®žçŽ°åŠŸèƒ½ä»£ç "
echo "   3. è¡¥å……æµ‹è¯•ï¼štests/$MOD/"
echo "   4. è¿è¡ŒéªŒè¯ï¼šmake dev_check"
