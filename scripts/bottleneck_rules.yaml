# æ•°æ®æµæ€§èƒ½ç“¶é¢ˆæ£€æµ‹è§„åˆ™é…ç½®
# Phase 13: æ•°æ®æµå¯è§†åŒ–å¢å¼º

version: "1.0"
description: "æ•°æ®æµæ€§èƒ½ç“¶é¢ˆæ£€æµ‹è§„åˆ™ï¼Œç”¨äºè‡ªåŠ¨åŒ–è¯†åˆ«æ€§èƒ½é—®é¢˜"

# æ£€æµ‹è§„åˆ™åˆ—è¡¨
rules:
  - id: "circular-dependency"
    name: "å¾ªç¯ä¾èµ–æ£€æµ‹"
    severity: critical
    category: "architecture"
    pattern: "å¾ªç¯ä¾èµ–"
    description: "æ£€æµ‹å›¾ä¸­çš„å¾ªç¯ä¾èµ–ï¼Œå¾ªç¯ä¾èµ–ä¼šå¯¼è‡´æ­»é”æˆ–æ— é™é€’å½’"
    detector: "DataflowAnalyzer.detect_circular_dependencies()"
    impact:
      performance: "å¯èƒ½å¯¼è‡´æ­»é”"
      maintainability: "ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤"
      scalability: "æ— æ³•æœ‰æ•ˆæ‰©å±•"
    suggestion:
      - "é‡æ„æ¨¡å—è§£è€¦ï¼Œæ‰“ç ´å¾ªç¯ä¾èµ–"
      - "å¼•å…¥ä¸­ä»‹è€…æ¨¡å¼æˆ–äº‹ä»¶é©±åŠ¨æ¶æ„"
      - "ä½¿ç”¨ä¾èµ–æ³¨å…¥åè½¬ä¾èµ–æ–¹å‘"
    fix_priority: 1
    estimated_fix_time: "2-4å°æ—¶"
  
  - id: "deep-call-chain"
    name: "è°ƒç”¨é“¾æ·±åº¦è¿‡æ·±"
    severity: high
    category: "performance"
    pattern: "è°ƒç”¨é“¾æ·±åº¦>5å±‚"
    description: "è°ƒç”¨é“¾è¿‡æ·±å¢åŠ è°ƒè¯•éš¾åº¦ï¼Œå¢åŠ æ€§èƒ½å¼€é”€"
    detector: "DataflowAnalyzer.analyze_call_chain_depth(max_depth=5)"
    threshold:
      max_depth: 5
      warning_depth: 4
    impact:
      performance: "å¢åŠ å‡½æ•°è°ƒç”¨å¼€é”€"
      debugging: "éš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•"
      error_handling: "é”™è¯¯ä¼ æ’­é“¾è¿‡é•¿"
    suggestion:
      - "è€ƒè™‘å¼•å…¥facadeæ¨¡å¼ç®€åŒ–æ¥å£"
      - "ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦å¤æ‚è°ƒç”¨é“¾"
      - "é‡æ„ä¸ºæ›´æ‰å¹³çš„æ¶æ„"
    fix_priority: 2
    estimated_fix_time: "1-3å°æ—¶"
  
  - id: "n-plus-one-query"
    name: "N+1æŸ¥è¯¢é—®é¢˜"
    severity: high
    category: "database"
    pattern: "å¾ªç¯å†…æ•°æ®åº“æŸ¥è¯¢"
    description: "åœ¨å¾ªç¯ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¯¼è‡´æŸ¥è¯¢æ¬¡æ•°å‘ˆçº¿æ€§å¢é•¿"
    detector: "DataflowAnalyzer.detect_n_plus_one_queries()"
    impact:
      performance: "ä¸¥é‡æ€§èƒ½ç“¶é¢ˆï¼Œå“åº”æ—¶é—´éšæ•°æ®é‡çº¿æ€§å¢é•¿"
      database: "æ•°æ®åº“è¿æ¥æ± è€—å°½"
      scalability: "æ— æ³•å¤„ç†å¤§æ•°æ®é‡"
    suggestion:
      - "ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æˆ–JOINæ›¿ä»£å¾ªç¯æŸ¥è¯¢"
      - "ä½¿ç”¨ORMçš„eager loadingï¼ˆé¢„åŠ è½½ï¼‰"
      - "è€ƒè™‘ä½¿ç”¨DataLoaderæ¨¡å¼"
    examples:
      bad: |
        for user in users:
            orders = db.query(Order).filter(user_id=user.id).all()
      good: |
        user_ids = [user.id for user in users]
        orders = db.query(Order).filter(Order.user_id.in_(user_ids)).all()
    fix_priority: 2
    estimated_fix_time: "30åˆ†é’Ÿ-1å°æ—¶"
  
  - id: "missing-index"
    name: "å¤§è¡¨JOINç¼ºå°‘ç´¢å¼•"
    severity: medium
    category: "database"
    pattern: "å¤§è¡¨JOINæ— ç´¢å¼•"
    description: "å¤§è¡¨æ‰§è¡ŒJOINæ“ä½œä½†JOINåˆ—ç¼ºå°‘ç´¢å¼•"
    detector: "DataflowAnalyzer.detect_missing_indexes()"
    threshold:
      table_size: "large"  # large: >100ä¸‡è¡Œ, very_large: >1000ä¸‡è¡Œ
    impact:
      performance: "æŸ¥è¯¢å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ "
      resource: "CPUå’Œå†…å­˜æ¶ˆè€—å¢åŠ "
      scalability: "æ•°æ®é‡å¢é•¿æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™"
    suggestion:
      - "åœ¨JOINåˆ—æ·»åŠ ç´¢å¼•: CREATE INDEX idx_name ON table(column)"
      - "è€ƒè™‘å¤åˆç´¢å¼•ä»¥ä¼˜åŒ–å¤šåˆ—JOIN"
      - "åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’: EXPLAIN ANALYZE"
    fix_priority: 3
    estimated_fix_time: "15-30åˆ†é’Ÿ"
  
  - id: "serial-calls"
    name: "å¯å¹¶è¡Œä½†ä¸²è¡Œæ‰§è¡Œ"
    severity: medium
    category: "performance"
    pattern: "ç‹¬ç«‹ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œ"
    description: "å¤šä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå¯ä»¥æ”¹ä¸ºå¹¶è¡Œä»¥æå‡æ€§èƒ½"
    detector: "BottleneckDetector.detect_serial_vs_parallel()"
    impact:
      performance: "æ€»å“åº”æ—¶é—´ä¸ºå„ä»»åŠ¡æ—¶é—´ä¹‹å’Œ"
      throughput: "ç³»ç»Ÿååé‡æœªå……åˆ†åˆ©ç”¨"
      user_experience: "ç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿"
    suggestion:
      - "ä½¿ç”¨asyncioæˆ–concurrent.futureså¹¶è¡Œæ‰§è¡Œ"
      - "ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†"
      - "è€ƒè™‘ä½¿ç”¨Promise.all()æˆ–Promise.race()"
    examples:
      bad: |
        result1 = fetch_data_from_api1()  # 1ç§’
        result2 = fetch_data_from_api2()  # 1ç§’
        # æ€»è€—æ—¶: 2ç§’
      good: |
        results = await asyncio.gather(
            fetch_data_from_api1(),
            fetch_data_from_api2()
        )
        # æ€»è€—æ—¶: 1ç§’
    fix_priority: 3
    estimated_fix_time: "30åˆ†é’Ÿ-2å°æ—¶"
  
  - id: "no-cache"
    name: "é«˜é¢‘è°ƒç”¨æœªç¼“å­˜"
    severity: low
    category: "performance"
    pattern: "é‡å¤è®¡ç®—å¯ç¼“å­˜æ•°æ®"
    description: "ç›¸åŒçš„è®¡ç®—æˆ–æŸ¥è¯¢è¢«å¤šæ¬¡æ‰§è¡Œï¼Œç»“æœåº”è¯¥è¢«ç¼“å­˜"
    detector: "BottleneckDetector.recommend_caching()"
    threshold:
      call_count: 3  # è°ƒç”¨æ¬¡æ•°è¶…è¿‡3æ¬¡
    impact:
      performance: "é‡å¤è®¡ç®—æµªè´¹CPUèµ„æº"
      response_time: "å“åº”æ—¶é—´å¯ä¼˜åŒ–"
      cost: "å¢åŠ ä¸å¿…è¦çš„æˆæœ¬"
    suggestion:
      - "ä½¿ç”¨Redisæˆ–Memcachedæ·»åŠ ç¼“å­˜å±‚"
      - "ä½¿ç”¨Pythonçš„@lru_cacheè£…é¥°å™¨"
      - "å®ç°åº”ç”¨çº§ç¼“å­˜ï¼ˆå¦‚functools.cacheï¼‰"
    cache_strategies:
      - name: "LRUç¼“å­˜"
        é€‚ç”¨: "å›ºå®šæ•°æ®é›†ï¼Œè®¿é—®æœ‰çƒ­ç‚¹"
      - name: "TTLç¼“å­˜"
        é€‚ç”¨: "æ•°æ®ä¼šè¿‡æœŸï¼Œéœ€è¦å®šæœŸåˆ·æ–°"
      - name: "åˆ†å¸ƒå¼ç¼“å­˜"
        é€‚ç”¨: "å¤šå®ä¾‹éƒ¨ç½²ï¼Œéœ€è¦å…±äº«ç¼“å­˜"
    fix_priority: 4
    estimated_fix_time: "30åˆ†é’Ÿ-1å°æ—¶"
  
  - id: "redundant-computation"
    name: "é‡å¤è®¡ç®—æ£€æµ‹"
    severity: low
    category: "performance"
    pattern: "ç›¸åŒè®¡ç®—é‡å¤æ‰§è¡Œ"
    description: "ç›¸åŒçš„è®¡ç®—é€»è¾‘åœ¨å¤šå¤„é‡å¤ï¼Œåº”è¯¥æå–ä¸ºå…±äº«å‡½æ•°"
    detector: "BottleneckDetector.detect_redundant_computations()"
    impact:
      maintainability: "ä»£ç é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜"
      performance: "è½»å¾®æ€§èƒ½å½±å“"
      consistency: "å¤šå¤„å®ç°å¯èƒ½ä¸ä¸€è‡´"
    suggestion:
      - "æå–å…±äº«å‡½æ•°æˆ–å·¥å…·ç±»"
      - "ä½¿ç”¨DRYåŸåˆ™ï¼ˆDon't Repeat Yourselfï¼‰"
      - "è€ƒè™‘ä½¿ç”¨å•ä¾‹æ¨¡å¼"
    fix_priority: 5
    estimated_fix_time: "15-30åˆ†é’Ÿ"

# ä¸¥é‡æ€§çº§åˆ«å®šä¹‰
severity_levels:
  critical:
    priority: 1
    color: "#d32f2f"
    icon: "ğŸ”´"
    action: "ç«‹å³ä¿®å¤"
    description: "ä¸¥é‡é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿæ•…éšœæˆ–æ•°æ®æŸå"
  
  high:
    priority: 2
    color: "#f57c00"
    icon: "ğŸŸ "
    action: "é«˜ä¼˜å…ˆçº§ä¿®å¤"
    description: "é‡è¦é—®é¢˜ï¼Œæ˜¾è‘—å½±å“æ€§èƒ½æˆ–ç”¨æˆ·ä½“éªŒ"
  
  medium:
    priority: 3
    color: "#fbc02d"
    icon: "ğŸŸ¡"
    action: "è®¡åˆ’ä¿®å¤"
    description: "ä¸­ç­‰é—®é¢˜ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´ä½†ä¸ç´§æ€¥"
  
  low:
    priority: 4
    color: "#388e3c"
    icon: "ğŸŸ¢"
    action: "å»ºè®®ä¼˜åŒ–"
    description: "è½»å¾®é—®é¢˜ï¼Œä¼˜åŒ–å»ºè®®"

# åˆ†ç±»å®šä¹‰
categories:
  architecture:
    name: "æ¶æ„é—®é¢˜"
    description: "ç³»ç»Ÿæ¶æ„å±‚é¢çš„é—®é¢˜"
  
  performance:
    name: "æ€§èƒ½é—®é¢˜"
    description: "å½±å“ç³»ç»Ÿæ€§èƒ½çš„é—®é¢˜"
  
  database:
    name: "æ•°æ®åº“é—®é¢˜"
    description: "æ•°æ®åº“æŸ¥è¯¢å’Œè®¾è®¡é—®é¢˜"
  
  scalability:
    name: "æ‰©å±•æ€§é—®é¢˜"
    description: "å½±å“ç³»ç»Ÿæ‰©å±•èƒ½åŠ›çš„é—®é¢˜"

# ä¼˜åŒ–å»ºè®®ä¼˜å…ˆçº§çŸ©é˜µ
priority_matrix:
  # severity x impact -> priority
  critical_high: 1    # ç«‹å³ä¿®å¤
  critical_medium: 1  # ç«‹å³ä¿®å¤
  critical_low: 2     # ä»Šå¤©ä¿®å¤
  high_high: 2        # æœ¬å‘¨ä¿®å¤
  high_medium: 3      # æœ¬æœˆä¿®å¤
  high_low: 3         # æœ¬æœˆä¿®å¤
  medium_high: 3      # æœ¬æœˆä¿®å¤
  medium_medium: 4    # å­£åº¦ä¿®å¤
  medium_low: 4       # å­£åº¦ä¿®å¤
  low_high: 4         # æŒ‰éœ€ä¿®å¤
  low_medium: 5       # æŒ‰éœ€ä¿®å¤
  low_low: 5          # æŒ‰éœ€ä¿®å¤

# å…ƒæ•°æ®
metadata:
  created_at: "2025-11-09"
  updated_at: "2025-11-09"
  version: "1.0"
  author: "AI-TEMPLATE Phase 13"

