# Agent.md YAML Front Matter Schema
# agent.mdYAML
# : 1.0

type: object
required: [spec_version, agent_id, role]

properties:
  # agent.md
  spec_version:
    type: string
    description: "Schema"
    pattern: "^\\d+\\.\\d+$"
  
  agent_id:
    type: string
    description: "Agent'repo''modules.<entity>.<instance>'"
    examples: ["repo", "modules.example.v1", "modules.user.v2"]
  
  role:
    type: string
    description: "Agent"
    minLength: 1
  
  # 
  level:
    type: integer
    minimum: 1
    maximum: 4
    description: "1-4"
  
  module_type:
    type: string
    description: "'1_Assign', '2_Select', '3_SelectMethod'"
    examples: ["1_example", "1_Assign", "2_Select", "3_SelectMethod"]
  
  # 
  ownership:
    type: object
    properties:
      code_paths:
        type: object
        description: ""
        properties:
          include:
            type: array
            items: {type: string}
            description: ""
            examples: [["modules/example/"]]
          exclude:
            type: array
            items: {type: string}
            description: ""
            examples: [["modules/*/doc/CHANGELOG.md"]]
  
  # 
  io:
    type: object
    properties:
      inputs:
        type: array
        items:
          type: object
          properties:
            name: {type: string}
            schema_ref: {type: string}
            description: {type: string}
        description: ""
      outputs:
        type: array
        items:
          type: object
          properties:
            name: {type: string}
            schema_ref: {type: string}
            description: {type: string}
        description: ""
  
  # 
  contracts:
    type: object
    properties:
      apis:
        type: array
        items: {type: string}
        description: ""
        examples: [["modules/example/doc/CONTRACT.md"]]
  
  # 
  dependencies:
    type: object
    properties:
      upstream:
        type: array
        items: {type: string}
        description: "agent_id"
        examples: [["modules.data_query.v1"]]
      downstream:
        type: array
        items: {type: string}
        description: "agent_id"
        examples: [["orchestrator.main"]]
  
  # 
  constraints:
    type: array
    items: {type: string}
    description: ""
    examples: [["must not access DB directly", "must maintain test coverage >= 80%"]]
  
  # 
  tools_allowed:
    type: object
    properties:
      calls:
        type: array
        items: {type: string}
        description: "/API"
        examples: [["http", "fs.read", "db.query"]]
      models:
        type: array
        items: {type: string}
        description: ""
        examples: [["gpt-4", "claude-3"]]
  
  # 
  quality_gates:
    type: object
    properties:
      required_tests:
        type: array
        items: {type: string}
        description: ""
        examples: [["unit", "integration", "smoke"]]
      coverage_min:
        type: number
        minimum: 0
        maximum: 1
        description: "0-1"
        examples: [0.80, 0.75]
  
  # 
  orchestration_hints:
    type: object
    properties:
      triggers:
        type: array
        items: {type: string}
        description: ""
        examples: [["on_http_request", "on_schedule", "on_event"]]
      routing_tags:
        type: array
        items: {type: string}
        description: ""
        examples: [["module:user", "level:1", "domain:auth"]]
      priority:
        type: integer
        minimum: 0
        description: ""
        examples: [5, 10]
  
  # 
  context_routes:
    type: object
    description: ""
    properties:
      always_read:
        type: array
        items: {type: string}
        description: ""
        examples: [["/doc/policies/goals.md", "/doc/policies/safety.md"]]
      on_demand:
        type: array
        items:
          type: object
          properties:
            topic: {type: string}
            paths: 
              type: array
              items: {type: string}
        description: "topic"
      by_scope:
        type: array
        items:
          type: object
          properties:
            scope: {type: string}
            read:
              type: array
              items: {type: string}
        description: ""
  
  # 
  policies:
    type: object
    description: "agent.md"
    properties:
      goals_ref: {type: string}
      safety_ref: {type: string}
  
  merge_strategy:
    type: string
    description: "agent.md"
    enum: ["child_overrides_parent", "parent_overrides_child"]
    examples: ["child_overrides_parent"]
  
  # Phase 6
  test_data:
    type: object
    description: "doc/TEST_DATA.md"
    properties:
      enabled:
        type: boolean
        description: ""
        default: false
      spec:
        type: string
        description: ""
        default: "doc/TEST_DATA.md"
        examples: ["doc/TEST_DATA.md"]
  
  # Phase 10
  trigger_config:
    type: object
    description: "agent-triggers.yaml"
    properties:
      enabled:
        type: boolean
        description: ""
        default: true
      rules:
        type: array
        description: "IDagent-triggers.yaml"
        items: {type: string}
        examples: [["database-operations", "module-development"]]
      exclude_rules:
        type: array
        description: "ID"
        items: {type: string}
        examples: [["security", "deployment"]]
      custom_triggers:
        type: array
        description: ""
        items:
          type: object
          properties:
            id: 
              type: string
              description: "ID"
            file_patterns:
              type: array
              items: {type: string}
              description: ""
            prompt_keywords:
              type: array
              items: {type: string}
              description: "Prompt"
            load_documents:
              type: array
              items:
                type: object
                properties:
                  path: {type: string}
                  priority: {type: string, enum: ["critical", "high", "medium", "low"]}

# 
additionalProperties: true

