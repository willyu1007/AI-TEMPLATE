# 开发计划模板

## 目标
[描述本次迭代要实现的具体目标]

**示例**：
- 完善 example 模块作为模板参考
- 提供完整的文档结构和验证流程

---

## 范围

### 包含（Scope In）
[列出本次迭代包含的功能]

**示例**：
- 文档结构示例
- 基础测试框架
- 验证和回滚流程

### 不包含（Scope Out）
[明确不在本次迭代的功能]

**示例**：
- 实际业务逻辑实现
- 生产环境部署
- 性能优化

---

## 影响分析

### 1. 接口变更
**新增接口**：
- 无

**修改接口**：
- 无

**废弃接口**：
- 无

### 2. 数据库变更
**新增表**：
- 无

**修改表结构**：
- 无

**数据迁移**：
- 无

### 3. DAG 节点变更
**变更说明**：
- 已在 `flows/dag.yaml` 中定义示例节点 `api.codegen`
- 无实际依赖关系变更

### 4. 配置变更
**新增配置项**：
- 无

**修改配置**：
- 无

---

## 测试清单

### 单元测试
- [ ] 核心逻辑单元测试
- [ ] 边界条件测试
- [ ] 错误处理测试

### 集成测试
- [ ] 模块间集成测试
- [ ] API 接口测试
- [ ] 数据库操作测试

### 验证测试
- [ ] 文档完整性检查（`make consistency_check`）
- [ ] 模板格式验证
- [ ] 示例代码可运行性

---

## 验证命令

### 开发环境验证
```
# 1. 完整检查
make dev_check

# 2. 文档索引生成
make docgen

# 3. 运行测试
pytest tests/example/ -v

# 4. DAG 校验
make dag_check
```

## 预期结果
- 所有检查通过
- 测试覆盖率 ≥ 80%
- 无 linter 错误

---

## 回滚计划

### 回滚触发条件
- 测试失败率 > 10%
- 性能下降 > 20%
- 发现严重 Bug

### 回滚步骤

#### 1. 代码回滚
```
# 方法 1：Git revert
git revert <commit-hash>
git push

# 方法 2：回退到上一标签
git checkout <previous-tag>
git push -f origin main  # 谨慎使用
```

## 2. 数据库回滚
```
# 如有数据库迁移
psql -d app -f migrations/<version>_down.sql

# 验证
\d+ table_name
```

## 3. 配置回滚
```
# 恢复配置文件
git checkout <previous-tag> -- config/

# 重新加载配置
docker-compose restart
```

## 4. 验证回滚
```
# 运行冒烟测试
pytest tests/example/test_smoke.py

# 检查服务状态
curl http://localhost:8000/health

# 运行完整检查
make dev_check
```

## 回滚时间目标
- **决策时间**：< 15 分钟
- **执行时间**：< 30 分钟
- **验证时间**：< 15 分钟
- **总计**：< 1 小时

---

## 风险评估

### 技术风险
| 风险项 | 可能性 | 影响 | 缓解措施 |
|--------|--------|------|---------|
| [风险描述] | 高/中/低 | 高/中/低 | [如何应对] |

**示例**：
| 风险项 | 可能性 | 影响 | 缓解措施 |
|--------|--------|------|---------|
| 文档不完整 | 低 | 中 | 使用 consistency_check 自动验证 |
| 模板过于复杂 | 中 | 中 | 提供简化版本和详细说明 |

---

## 时间规划

### 阶段划分
1. **计划与设计**：[预计时间]
2. **实现与测试**：[预计时间]
3. **文档与验证**：[预计时间]
4. **回顾与优化**：[预计时间]

**示例**：
1. **计划与设计**：0.5 天
2. **实现与测试**：1 天
3. **文档与验证**：0.5 天
4. **回顾与优化**：0.5 天

总计：2.5 天

---

## 相关文档
- **模块架构**：`README.md`
- **接口契约**：`CONTRACT.md`
- **测试计划**：`TEST_PLAN.md`
- **运维手册**：`RUNBOOK.md`
- **开发流程**：`agent.md` §5

