# 缺陷管理（Bugs）

## 目标
系统化跟踪和管理 common 模块缺陷，积累问题解决经验，持续改进代码质量。

## 适用场景
- 记录已知缺陷
- 跟踪修复进度
- 复盘和经验总结

## 使用说明
1. 发现缺陷后立即记录
2. 按严重程度分类和优先级排序
3. 修复后移至"已修复"章节
4. 定期进行缺陷复盘

---

## 已知缺陷

### 当前无活跃缺陷 ✅

### 缺陷记录模板
使用以下格式记录新缺陷：

```markdown
- [ ] **BUG-XXX**: [缺陷简短描述]
  - **发现日期**: YYYY-MM-DD
  - **影响**: Critical/High/Medium/Low
  - **复现步骤**:
    1. [步骤1]
    2. [步骤2]
    3. [步骤3]
  - **期望行为**: [应该如何]
  - **实际行为**: [实际发生了什么]
  - **影响范围**: [影响的功能/用户]
  - **临时方案**: [规避措施，如有]
  - **根因分析**: [初步分析，如已知]
  - **优先级**: P0/P1/P2/P3
```

---

## 已修复缺陷

### BUG-001: 示例 - 加密模块 Windows 编码问题 ✅
- **修复时间**: 2025-11-09
- **影响**: Medium
- **修复方案**: 在所有文件读取操作中添加 `encoding='utf-8'` 参数
- **验证**: Windows 和 macOS 环境测试通过
- **提交**: commit abc1234

---

## 缺陷复盘

### BUG-001 复盘报告（示例）

#### 问题描述
在 Windows 环境下，encryption.py 读取配置文件时出现编码错误，导致加密初始化失败。

#### 根因分析

**直接原因**：
- 文件读取未指定 UTF-8 编码
- Windows 默认使用 GBK 编码

**深层原因**：
- 缺少跨平台编码测试
- 缺少统一的文件读取工具函数

#### 影响范围评估
| 维度 | 影响程度 | 说明 |
|------|---------|------|
| 用户体验 | 高 | Windows 用户无法使用 |
| 功能影响 | 高 | 加密功能完全不可用 |
| 数据影响 | 无 | 无数据丢失 |
| 安全影响 | 无 | 无安全问题 |

**影响用户数**: 约 30% (Windows 用户)  
**持续时间**: 1 天  
**严重程度**: Medium

#### 解决时间线
| 时间 | 事件 |
|------|------|
| 2025-11-09 10:00 | 用户报告编码错误 |
| 2025-11-09 11:00 | 确认问题并定位根因 |
| 2025-11-09 14:00 | 修复所有文件读取操作 |
| 2025-11-09 15:00 | 验证修复并部署 |

**总耗时**: 5 小时（发现到修复）  
**修复耗时**: 3 小时

#### 改进措施

**已实施**：
1. ✅ 统一文件读取操作，强制 UTF-8 编码
2. ✅ 增加 Windows 环境测试
3. ✅ 添加 python_scripts_lint 检查

**计划中**：
1. ⏸️ 创建统一的文件读取工具函数
2. ⏸️ 增加跨平台集成测试
3. ⏸️ 更新开发规范

#### 经验教训

**技术层面**：
- 跨平台兼容性需要从一开始就考虑
- 文件操作必须显式指定编码
- 自动化检查可以防止此类问题

**流程层面**：
- 需要覆盖多平台的测试环境
- 代码审查需要关注跨平台问题
- 用户反馈渠道很重要

**预防措施**：
1. 所有文件操作必须指定 `encoding='utf-8'`
2. CI 中增加 Windows 测试
3. 使用 linter 检查编码问题

---

## 缺陷统计

### 当前月度统计（2025-11）
| 指标 | 数值 |
|------|------|
| 活跃缺陷 | 0 |
| 新增缺陷 | 1 |
| 已修复 | 1 |
| 平均修复时间 | 3小时 |

### 按严重程度分类
| 严重程度 | 活跃 | 已修复 |
|---------|------|--------|
| Critical (P0) | 0 | 0 |
| High (P1) | 0 | 0 |
| Medium (P2) | 0 | 1 |
| Low (P3) | 0 | 0 |

---

## 缺陷趋势

### 月度趋势
| 月份 | 新增 | 修复 | 累计活跃 |
|------|------|------|---------|
| 2025-11 | 1 | 1 | 0 |

### 分析
- ✅ 缺陷修复及时，无积压
- ✅ 质量稳定
- ⚠️ 需要继续观察

---

## 缺陷处理流程

### 1. 发现缺陷
```bash
# 记录到 BUGS.md
vim modules/common/doc/BUGS.md

# 创建 Issue（如使用 GitHub）
gh issue create --title "BUG: ..." --label bug --label common
```

### 2. 分类和优先级
| 严重程度 | 响应时间 | 修复时间 |
|---------|---------|---------|
| P0 (Critical) | 立即 | < 4 小时 |
| P1 (High) | < 2 小时 | < 1 天 |
| P2 (Medium) | < 1 天 | < 1 周 |
| P3 (Low) | < 1 周 | 下个版本 |

### 3. 修复和验证
```bash
# 1. 创建修复分支
git checkout -b fix/common-bug-xxx

# 2. 修复代码
# ... 编写修复代码 ...

# 3. 添加回归测试
# ... 编写测试防止复现 ...

# 4. 验证修复
pytest tests/common/ -v
make dev_check

# 5. 提交 PR
git commit -m "fix(common): 修复 BUG-XXX"
```

### 4. 复盘和改进
```bash
# 修复完成后进行复盘
# 更新 BUGS.md 的复盘章节
```

---

## 相关文档
- **测试计划**: `TEST_PLAN.md`
- **变更日志**: `CHANGELOG.md`
- **进度跟踪**: `PROGRESS.md`
- **模块架构**: `README.md`

